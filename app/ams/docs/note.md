# 検討ノート・メモ

## GitHub Actions CI エラー対応 (2025-08-03)

### 問題の概要
GitHub ActionsのCIパイプラインで「Run tests with coverage」ステップがタイムアウトエラーで失敗していました。

### 根本原因
1. 統合テスト（`test_small_scale_integration.py`）が実際のLLM APIコールを実行
2. CI環境でAPIキーが設定されていない、またはタイムアウト時間が不十分
3. 全てのテストを一括実行していたため、統合テストのタイムアウトでCIが失敗

### 実施した対策

#### 1. 即時対応：CIワークフローの修正
- `.github/workflows/ci.yml`を修正
- ユニットテストのみを実行するように変更（`tests/unit/`のみ）
- タイムアウトを60秒に設定
- カバレッジ要件は85%を維持

#### 2. 長期対応：全サブシステム対応のワークフロー作成
- `.github/workflows/test-all-subsystems.yml`を新規作成
- 特徴：
  - app/配下の全サブシステムを自動検出
  - 各サブシステムで独立してテスト実行
  - 統合テストは別ジョブで実行（APIキー設定時のみ）
  - 失敗しても他のジョブは継続

#### 3. ドキュメント化
- `docs/github-actions-ci-specification.md`を作成
- CI/CD仕様、テスト戦略、トラブルシューティングガイドを記載

### 検証結果
- ローカル環境でのユニットテスト：PASS（カバレッジ85.78%）
- lintチェック（ruff, black）：PASS
- 型チェック（mypy）：PASS

### 今後の作業
1. 現在の変更をコミットしてPRを更新
2. CI実行結果を確認
3. 必要に応じて統合テスト用のAPIキーをGitHub Secretsに設定

### 補足事項
- a2aサブシステムには独自のテスト構成がないため、将来的に追加が必要
- 統合テストはAPIコストがかかるため、CI環境では最小限の実行に留める
- パフォーマンステストやE2Eテストはローカル環境での実行を推奨