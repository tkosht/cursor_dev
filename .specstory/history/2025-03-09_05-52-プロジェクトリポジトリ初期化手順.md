<!-- Generated by SpecStory -->

# プロジェクトリポジトリ初期化手順 (2025-03-09 14:52:10)

_**User**_

本プロジェクトリポジトリの初期化手順を構築したいです。

---

_**Assistant**_

読み込んだルール: development.mdc, project.mdc, workflow.mdc, global.mdc, python.mdc, rules.mdc

プロジェクトの初期化手順を構築いたします。

# 実行結果報告

## 概要
プロジェクトの初期化手順を、既存のコードベースと設定に基づいて作成します。

## 初期化手順

1. **開発環境のセットアップ**
```bash
# 1. VSCode Dev Containerの設定
code .
# Dev Container拡張機能をインストール
# 左下の「><」アイコンから「Reopen in Container」を選択

# 2. コンテナ内での作業
cd ~/workspace

# 3. Poetryのインストールと初期化
curl -sSL https://install.python-poetry.org | python3 -
poetry init \
    --name "query-monitor" \
    --description "Dify APIクエリ監視システム" \
    --author "Your Name <your.email@example.com>" \
    --python "^3.12" \
    --dependency "requests" \
    --dependency "slack-sdk" \
    --dev-dependency "pytest" \
    --dev-dependency "black" \
    --dev-dependency "flake8" \
    --dev-dependency "isort"

# 4. 仮想環境の作成と依存関係のインストール
poetry config virtualenvs.in-project true
poetry install
```

2. **プロジェクト構造の作成**
```bash
# 必要なディレクトリの作成
mkdir -p app docs/{01.requirements,02.basic_design,03.detail_design,11.errors,12.fixes,31.progress,90.references,91.notes} tests knowledge memory-bank logs bin
```

3. **環境変数の設定**
```bash
# .env ファイルの作成（※実際の値は別途安全に管理）
cat << EOF > .env
DIFY_API_KEY=your_dify_api_key
SLACK_TOKEN=your_slack_token
SLACK_CHANNEL=your_slack_channel
EOF
```

4. **初期設定ファイルの作成**
```bash
# queries.json の作成
cat << EOF > app/queries.json
{
    "queries": [
        {
            "query": "テストクエリ",
            "channel": "general"
        }
    ]
}
EOF

# README.md の作成
cat << EOF > README.md
# Query Monitor

Dify APIを使用したクエリ監視システム

## 必要条件
- Python 3.12
- Poetry
- VSCode + Dev Container

## セットアップ
1. リポジトリのクローン
2. VSCodeでDev Containerを開く
3. \`.env\`ファイルの設定
4. \`poetry install\`の実行

## 使用方法
\`\`\`bash
poetry run python app/query_monitor.py
\`\`\`

## 開発
- コードフォーマット: \`poetry run black .\`
- リントチェック: \`poetry run flake8 --exclude .venv\`
- テスト実行: \`poetry run pytest\`
EOF
```

5. **Memory Bankの初期化**
```bash
# projectbrief.md の作成
cat << EOF > memory-bank/projectbrief.md
# プロジェクト概要

Dify APIを使用したクエリ監視システム
EOF

# 他のMemory Bankファイルも同様に作成
```

6. **テストの初期設定**
```bash
# テストファイルの作成
cat << EOF > tests/test_query_monitor.py
import pytest
from app.query_monitor import QueryMonitor

def test_query_monitor_initialization():
    with pytest.raises(ValueError):
        QueryMonitor("", "", "")
EOF
```

## 注意点・改善提案

1. セキュリティ関連
- `.env`ファイルは`.gitignore`に追加し、機密情報が漏洩しないようにする
- 本番環境の認証情報は別途安全に管理する

2. 開発フロー
- コミット前に必ずコードフォーマットとリントチェックを実行する
- テストを追加する際は、`tests/`ディレクトリ内に適切に配置する

3. ドキュメント
- 各ディレクトリには`README.md`を作成し、目的と内容を明記する
- API仕様やシステム設計は`docs/`ディレクトリに適切に配置する

4. CI/CD
- GitHub Actionsなどでの自動テスト・リントチェックの設定を検討する

これらの手順に従って初期化を行うことで、プロジェクトの基盤を整備できます。

---

_**User**_

そうじゃなくて、開発をゼロに戻して空リポジトリにしたいですが、ルール等は残したいです。

---

_**Assistant**_

読み込んだルール: development.mdc, project.mdc, workflow.mdc, global.mdc, python.mdc, rules.mdc

プロジェクトを初期状態に戻す手順を作成いたします。

# 実行結果報告

## 概要
既存のルールと設定を保持しながら、開発コードをクリーンな状態にリセットします。

## 実行手順

1. **保持するファイルの退避**
```bash
# 一時ディレクトリの作成
mkdir -p /tmp/project_backup

# .cursor/rules/ ディレクトリの退避（プロジェクトルール）
cp -r .cursor/rules/ /tmp/project_backup/

# .devcontainer の退避（開発環境設定）
cp -r .devcontainer/ /tmp/project_backup/
```

2. **リポジトリのクリーンアップ**
```bash
# git管理外のファイルも含めて全削除（.gitとバックアップしたファイル以外）
rm -rf *
rm -rf .env .venv logs/ __pycache__/ .pytest_cache/
```

3. **必要なディレクトリ構造の再作成**
```bash
# プロジェクト規定のディレクトリ構造を作成
mkdir -p app/ \
    bin/ \
    docs/{01.requirements,02.basic_design,03.detail_design,11.errors,12.fixes,31.progress,90.references,91.notes} \
    knowledge/ \
    memory-bank/ \
    tests/
```

4. **退避したファイルの復元**
```bash
# ルールの復元
cp -r /tmp/project_backup/rules/ .cursor/

# 開発環境設定の復元
cp -r /tmp/project_backup/.devcontainer/ ./

# 一時ディレクトリの削除
rm -rf /tmp/project_backup
```

5. **最小限の初期ファイルの作成**
```bash
# pyproject.toml の作成
cat << EOF > pyproject.toml
[tool.poetry]
name = "project"
version = "0.1.0"
description = ""
authors = ["Your Name <your.email@example.com>"]

[tool.poetry.dependencies]
python = "^3.12"

[tool.poetry.group.dev.dependencies]
pytest = "^8.0.0"
black = "^24.1.0"
flake8 = "^7.0.0"
isort = "^5.13.0"

[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"
EOF

# README.md の作成
cat << EOF > README.md
# Project Name

プロジェクトの説明をここに記載

## 開発環境

- Python 3.12
- Poetry
- VSCode + Dev Container

## セットアップ

1. リポジトリのクローン
2. VSCodeでDev Containerを開く
3. \`poetry install\`の実行

## 開発ルール

開発ルールは .cursor/rules/ ディレクトリを参照してください。
EOF

# .gitignore の作成
cat << EOF > .gitignore
# Python
__pycache__/
*.py[cod]
*$py.class
.Python
.env
.venv/
.pytest_cache/

# IDE
.vscode/
.idea/

# Logs
logs/
*.log

# その他
.DS_Store
EOF
```

6. **Memory Bankの初期化**
```bash
# projectbrief.md の作成
cat << EOF > memory-bank/projectbrief.md
# プロジェクト概要

プロジェクトの目的と概要をここに記載してください。
EOF

# 他の必要なMemory Bankファイルの作成
for file in productContext systemPatterns techContext activeContext progress; do
    touch "memory-bank/${file}.md"
done
```

## 注意点・改善提案

1. **確認事項**
- `.cursor/rules/`のルールファイルが正しく復元されていることを確認
- `.devcontainer`の設定が正しく機能することを確認

2. **次のステップ**
- Memory Bankの各ファイルに適切な初期内容を記載
- 開発を始める前に、プロジェクトの要件定義を`docs/01.requirements/`に記載
- チーム開発の場合は、コーディング規約等を`docs/`に追加

3. **開発環境の確認**
```bash
# Poetry環境の初期化
poetry install

# Dev Container環境の動作確認
code .
# 「Dev Containerで開き直す」を実行
```

これで、ルールと開発環境設定を保持したまま、クリーンな状態からプロジェクトを再開できる状態になりました。

---



---

