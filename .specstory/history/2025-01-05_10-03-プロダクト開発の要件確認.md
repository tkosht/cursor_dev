<!-- Generated by SpecStory -->

# ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆé–‹ç™ºã®è¦ä»¶ç¢ºèª (2025-01-05 19:03:40)

_**User**_

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¨@development_rules.md ã«å¾“ã„ã€ @requirements.md ã®è¦ä»¶ã‚’æº€ãŸã™ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®é–‹ç™ºã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚

---

_**Assistant**_

ã¯ã„ã€æ‰¿çŸ¥ã„ãŸã—ã¾ã—ãŸã€‚ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®šç¾©ã«å¾“ã£ã¦é–‹ç™ºã‚’é€²ã‚ã¦ã„ãã¾ã™ã€‚

ã¾ãšã€ã‚¹ãƒ†ãƒƒãƒ—0ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ã€‚

è¦ä»¶å®šç¾©æ›¸ã€åŸºæœ¬è¨­è¨ˆæ›¸ã€è©³ç´°è¨­è¨ˆæ›¸ã®å†…å®¹ã‚’ç¢ºèªã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚

---

<details>
            <summary>Listed directory docs/02.basic_design â€¢ **1** results</summary>
        
| Name |
|-------|
| ğŸ“„ `basic_design.md` |

</details>

---

<details>
            <summary>Listed directory docs/03.detail_design â€¢ **1** results</summary>
        
| Name |
|-------|
| ğŸ“„ `detail_design.md` |

</details>

---



åŸºæœ¬è¨­è¨ˆæ›¸ã¨è©³ç´°è¨­è¨ˆæ›¸ã®å†…å®¹ã‚’ç¢ºèªã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚

---

Read file: docs/02.basic_design/basic_design.md

---

Read file: docs/03.detail_design/detail_design.md

---



è¦ä»¶å®šç¾©æ›¸ã€åŸºæœ¬è¨­è¨ˆæ›¸ã€è©³ç´°è¨­è¨ˆæ›¸ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚æ¬¡ã«ã€é€²æ—çŠ¶æ³ã‚’ç¢ºèªã—ã¾ã™ã€‚

---

<details>
            <summary>Listed directory docs/31.progress â€¢ **4** results</summary>
        
| Name |
|-------|
| ğŸ“„ `2025-01-05-18-38-39.md` |
| ğŸ“„ `2025-01-05-16-34-28.md` |
| ğŸ“„ `2025-01-05-16-31-26.md` |
| ğŸ“„ `2025-01-05-15-43-11.md` |

</details>

---



æœ€æ–°ã®é€²æ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¾ã™ã€‚

---

Read file: docs/31.progress/2025-01-05-18-38-39.md

---



é€²æ—çŠ¶æ³ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¨ã—ã¦ã€ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œã¨çµæœã®ç¢ºèªãŒäºˆå®šã•ã‚Œã¦ã„ã¾ã™ã€‚

ã¾ãšã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ§‹é€ ã‚’ç¢ºèªã—ã€å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚

---

<details>
            <summary>Listed current directory â€¢ **32** results</summary>
        
| Name |
|-------|
| ğŸ“„ `pyproject.toml` |
| ğŸ“„ `.env` |
| ğŸ“„ `.coverage` |
| ğŸ“„ `poetry.lock` |
| ğŸ“ `tests` |
| ğŸ“ `config` |
| ğŸ“„ `pytest.ini` |
| ğŸ“ `app` |
| ğŸ“ `.git` |
| ğŸ“ `docs` |
| ğŸ“„ `compose.override.yml` |
| ğŸ“ `docker` |
| ğŸ“ `data` |
| ğŸ“„ `.cursorrules` |
| ğŸ“„ `.gitignore` |
| ğŸ“„ `.cursorban` |
| ğŸ“„ `README.md` |
| ğŸ“„ `.flake8` |
| ğŸ“ `.ssh` |
| ğŸ“„ `compose.yml` |
| ğŸ“„ `Makefile` |
| ğŸ“ `.pytest_cache` |
| ğŸ“ `.venv` |
| ğŸ“ `notebooks` |
| ğŸ“ `bin` |
| ğŸ“ `.vscode` |
| ğŸ“ `.github` |
| ğŸ“ `.devcontainer` |
| ğŸ“„ `cursor_dev.code-workspace` |
| ğŸ“„ `.dockerignore` |
| ğŸ“„ `LICENSE` |
| ğŸ“ `rc` |

</details>

---

<details>
            <summary>Listed directory app â€¢ **7** results</summary>
        
| Name |
|-------|
| ğŸ“ `core` |
| ğŸ“ `services` |
| ğŸ“ `config` |
| ğŸ“ `db` |
| ğŸ“ `examples` |
| ğŸ“ `__pycache__` |
| ğŸ“„ `__init__.py` |

</details>

---

<details>
            <summary>Listed directory tests â€¢ **4** results</summary>
        
| Name |
|-------|
| ğŸ“ `unit` |
| ğŸ“ `__pycache__` |
| ğŸ“„ `conftest.py` |
| ğŸ“ `integration` |

</details>

---



ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ§‹é€ ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚æ¬¡ã«ã€ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹å‰ã«ã€pytest.iniã®è¨­å®šã‚’ç¢ºèªã—ã¾ã™ã€‚

---

Read file: pytest.ini

---



æ¬¡ã«ã€ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ã¾ãšã¯å˜ä½“ãƒ†ã‚¹ãƒˆã‹ã‚‰å®Ÿè¡Œã—ã¾ã™ã€‚

---

```bash
poetry run pytest tests/unit/ -v
```

```
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
_____________________________________ ERROR at setup of test_find_node _____________________________________

mock_driver = <MagicMock name='AsyncGraphDatabase' id='123543349534224'>

    @pytest.fixture
    async def neo4j_connection(mock_driver):
        """Neo4jConnectionã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹"""
>       connection = Neo4jConnection()

tests/unit/test_neo4j.py:18: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.db.neo4j.Neo4jConnection object at 0x705cad75fd30>

    def __init__(self):
        """åˆæœŸåŒ–"""
>       self.uri = settings.NEO4J_URI
E       AttributeError: module 'app.config.settings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER
'?

app/db/neo4j.py:13: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
_________________________________ ERROR at setup of test_get_relationship __________________________________

mock_driver = <MagicMock name='AsyncGraphDatabase' id='123543348222880'>

    @pytest.fixture
    async def neo4j_connection(mock_driver):
        """Neo4jConnectionã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹"""
>       connection = Neo4jConnection()

tests/unit/test_neo4j.py:18: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.db.neo4j.Neo4jConnection object at 0x705cad7b6bc0>

    def __init__(self):
        """åˆæœŸåŒ–"""
>       self.uri = settings.NEO4J_URI
E       AttributeError: module 'app.config.settings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER
'?

app/db/neo4j.py:13: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
________________________________ ERROR at setup of test_update_relationship ________________________________

mock_driver = <MagicMock name='AsyncGraphDatabase' id='123543349349536'>

    @pytest.fixture
    async def neo4j_connection(mock_driver):
        """Neo4jConnectionã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹"""
>       connection = Neo4jConnection()

tests/unit/test_neo4j.py:18: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.db.neo4j.Neo4jConnection object at 0x705cad7dc280>

    def __init__(self):
        """åˆæœŸåŒ–"""
>       self.uri = settings.NEO4J_URI
E       AttributeError: module 'app.config.settings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER
'?

app/db/neo4j.py:13: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
_____________________________________ ERROR at setup of test_run_query _____________________________________

mock_driver = <MagicMock name='AsyncGraphDatabase' id='123543349846720'>

    @pytest.fixture
    async def neo4j_connection(mock_driver):
        """Neo4jConnectionã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹"""
>       connection = Neo4jConnection()

tests/unit/test_neo4j.py:18: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.db.neo4j.Neo4jConnection object at 0x705cad62abf0>

    def __init__(self):
        """åˆæœŸåŒ–"""
>       self.uri = settings.NEO4J_URI
E       AttributeError: module 'app.config.settings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER
'?

app/db/neo4j.py:13: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
____________________________________ ERROR at setup of test_query_error ____________________________________

mock_driver = <MagicMock name='AsyncGraphDatabase' id='123543348416944'>

    @pytest.fixture
    async def neo4j_connection(mock_driver):
        """Neo4jConnectionã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹"""
>       connection = Neo4jConnection()

tests/unit/test_neo4j.py:18: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.db.neo4j.Neo4jConnection object at 0x705cad628f40>

    def __init__(self):
        """åˆæœŸåŒ–"""
>       self.uri = settings.NEO4J_URI
E       AttributeError: module 'app.config.settings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER
'?

app/db/neo4j.py:13: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
______________________________________ ERROR at setup of test_connect ______________________________________

    @pytest.fixture
    async def neo4j_connection():
        """Neo4jConnectionã®ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£"""
>       connection = Neo4jConnection()

tests/unit/test_neo4j_connection.py:8: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.db.neo4j.Neo4jConnection object at 0x705cad66ab00>

    def __init__(self):
        """åˆæœŸåŒ–"""
>       self.uri = settings.NEO4J_URI
E       AttributeError: module 'app.config.settings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER
'?

app/db/neo4j.py:13: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
____________________________________ ERROR at setup of test_create_node ____________________________________

    @pytest.fixture
    async def neo4j_connection():
        """Neo4jConnectionã®ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£"""
>       connection = Neo4jConnection()

tests/unit/test_neo4j_connection.py:8: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.db.neo4j.Neo4jConnection object at 0x705cad628100>

    def __init__(self):
        """åˆæœŸåŒ–"""
>       self.uri = settings.NEO4J_URI
E       AttributeError: module 'app.config.settings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER
'?

app/db/neo4j.py:13: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
________________________________ ERROR at setup of test_create_relationship ________________________________

    @pytest.fixture
    async def neo4j_connection():
        """Neo4jConnectionã®ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£"""
>       connection = Neo4jConnection()

tests/unit/test_neo4j_connection.py:8: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.db.neo4j.Neo4jConnection object at 0x705cad647eb0>

    def __init__(self):
        """åˆæœŸåŒ–"""
>       self.uri = settings.NEO4J_URI
E       AttributeError: module 'app.config.settings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER
'?

app/db/neo4j.py:13: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
_____________________________________ ERROR at setup of test_find_node _____________________________________

    @pytest.fixture
    async def neo4j_connection():
        """Neo4jConnectionã®ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£"""
>       connection = Neo4jConnection()

tests/unit/test_neo4j_connection.py:8: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.db.neo4j.Neo4jConnection object at 0x705cad7b53f0>

    def __init__(self):
        """åˆæœŸåŒ–"""
>       self.uri = settings.NEO4J_URI
E       AttributeError: module 'app.config.settings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER
'?

app/db/neo4j.py:13: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
_________________________________ ERROR at setup of test_connection_error __________________________________

    @pytest.fixture
    async def neo4j_connection():
        """Neo4jConnectionã®ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£"""
>       connection = Neo4jConnection()

tests/unit/test_neo4j_connection.py:8: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.db.neo4j.Neo4jConnection object at 0x705cad68c0d0>

    def __init__(self):
        """åˆæœŸåŒ–"""
>       self.uri = settings.NEO4J_URI
E       AttributeError: module 'app.config.settings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER
'?

app/db/neo4j.py:13: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
_______________________________________ ERROR at setup of test_close _______________________________________

    @pytest.fixture
    async def neo4j_connection():
        """Neo4jConnectionã®ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£"""
>       connection = Neo4jConnection()

tests/unit/test_neo4j_connection.py:8: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.db.neo4j.Neo4jConnection object at 0x705cad629240>

    def __init__(self):
        """åˆæœŸåŒ–"""
>       self.uri = settings.NEO4J_URI
E       AttributeError: module 'app.config.settings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER
'?

app/db/neo4j.py:13: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
_______________________________ ERROR at setup of test_search_with_all_types _______________________________

    @pytest.fixture
    async def search_engine():
        """ãƒ†ã‚¹ãƒˆç”¨ã®MarketSearchEngineã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ"""
>       engine = MarketSearchEngine()

tests/unit/test_search.py:10: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.core.search.MarketSearchEngine object at 0x705cad7b41f0>

    def __init__(self):
        """åˆæœŸåŒ–"""
        self.session = None
        self.search_providers = {
            'news': self._search_news,
            'research': self._search_research,
            'company': self._search_company,
            'social': self._search_social,
        }
        self.headers = {
>           'User-Agent': settings.USER_AGENT
        }
E       AttributeError: module 'app.config.settings' has no attribute 'USER_AGENT'

app/core/search.py:24: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
_____________________________ ERROR at setup of test_search_with_specific_type _____________________________

    @pytest.fixture
    async def search_engine():
        """ãƒ†ã‚¹ãƒˆç”¨ã®MarketSearchEngineã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ"""
>       engine = MarketSearchEngine()

tests/unit/test_search.py:10: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.core.search.MarketSearchEngine object at 0x705cad647280>

    def __init__(self):
        """åˆæœŸåŒ–"""
        self.session = None
        self.search_providers = {
            'news': self._search_news,
            'research': self._search_research,
            'company': self._search_company,
            'social': self._search_social,
        }
        self.headers = {
>           'User-Agent': settings.USER_AGENT
        }
E       AttributeError: module 'app.config.settings' has no attribute 'USER_AGENT'

app/core/search.py:24: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
_____________________________ ERROR at setup of test_search_with_invalid_type ______________________________

    @pytest.fixture
    async def search_engine():
        """ãƒ†ã‚¹ãƒˆç”¨ã®MarketSearchEngineã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ"""
>       engine = MarketSearchEngine()

tests/unit/test_search.py:10: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.core.search.MarketSearchEngine object at 0x705cad68c760>

    def __init__(self):
        """åˆæœŸåŒ–"""
        self.session = None
        self.search_providers = {
            'news': self._search_news,
            'research': self._search_research,
            'company': self._search_company,
            'social': self._search_social,
        }
        self.headers = {
>           'User-Agent': settings.USER_AGENT
        }
E       AttributeError: module 'app.config.settings' has no attribute 'USER_AGENT'

app/core/search.py:24: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
_________________________________ ERROR at setup of test_content_filtering _________________________________

    @pytest.fixture
    async def search_engine():
        """ãƒ†ã‚¹ãƒˆç”¨ã®MarketSearchEngineã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ"""
>       engine = MarketSearchEngine()

tests/unit/test_search.py:10: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.core.search.MarketSearchEngine object at 0x705cad661db0>

    def __init__(self):
        """åˆæœŸåŒ–"""
        self.session = None
        self.search_providers = {
            'news': self._search_news,
            'research': self._search_research,
            'company': self._search_company,
            'social': self._search_social,
        }
        self.headers = {
>           'User-Agent': settings.USER_AGENT
        }
E       AttributeError: module 'app.config.settings' has no attribute 'USER_AGENT'

app/core/search.py:24: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
________________________________ ERROR at setup of test_concurrent_searches ________________________________

    @pytest.fixture
    async def search_engine():
        """ãƒ†ã‚¹ãƒˆç”¨ã®MarketSearchEngineã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ"""
>       engine = MarketSearchEngine()

tests/unit/test_search.py:10: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.core.search.MarketSearchEngine object at 0x705cad6966e0>

    def __init__(self):
        """åˆæœŸåŒ–"""
        self.session = None
        self.search_providers = {
            'news': self._search_news,
            'research': self._search_research,
            'company': self._search_company,
            'social': self._search_social,
        }
        self.headers = {
>           'User-Agent': settings.USER_AGENT
        }
E       AttributeError: module 'app.config.settings' has no attribute 'USER_AGENT'

app/core/search.py:24: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
_________________________________ ERROR at setup of test_fetch_url_success _________________________________

    @pytest.fixture
    async def web_crawler():
        crawler = WebCrawlerService()
>       await crawler.start_session()
E       AttributeError: 'WebCrawlerService' object has no attribute 'start_session'

tests/unit/test_web_crawler.py:10: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
INFO     app.services.web:web.py:23 WebCrawlerServiceã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸ
___________________________ ERROR at setup of test_fetch_url_retry_on_rate_limit ___________________________

    @pytest.fixture
    async def web_crawler():
        crawler = WebCrawlerService()
>       await crawler.start_session()
E       AttributeError: 'WebCrawlerService' object has no attribute 'start_session'

tests/unit/test_web_crawler.py:10: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
INFO     app.services.web:web.py:23 WebCrawlerServiceã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸ
____________________________________ ERROR at setup of test_crawl_urls _____________________________________

    @pytest.fixture
    async def web_crawler():
        crawler = WebCrawlerService()
>       await crawler.start_session()
E       AttributeError: 'WebCrawlerService' object has no attribute 'start_session'

tests/unit/test_web_crawler.py:10: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
INFO     app.services.web:web.py:23 WebCrawlerServiceã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸ
_____________________________ ERROR at setup of test_fetch_url_error_handling ______________________________

    @pytest.fixture
    async def web_crawler():
        crawler = WebCrawlerService()
>       await crawler.start_session()
E       AttributeError: 'WebCrawlerService' object has no attribute 'start_session'

tests/unit/test_web_crawler.py:10: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
INFO     app.services.web:web.py:23 WebCrawlerServiceã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸ
____________________________ ERROR at setup of test_crawl_urls_partial_failure _____________________________

    @pytest.fixture
    async def web_crawler():
        crawler = WebCrawlerService()
>       await crawler.start_session()
E       AttributeError: 'WebCrawlerService' object has no attribute 'start_session'

tests/unit/test_web_crawler.py:10: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
INFO     app.services.web:web.py:23 WebCrawlerServiceã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸ
================================================= FAILURES =================================================
____________________________________________ test_build_prompt _____________________________________________

gemini_service = <app.services.gemini.GeminiService object at 0x705cad765900>

    def test_build_prompt(gemini_service):
        """ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹ç¯‰ã®ãƒ†ã‚¹ãƒˆ"""
        # æ­£å¸¸ç³»
        template = "Hello {name}!"
>       result = gemini_service._build_prompt(template, name="World")
E       AttributeError: 'GeminiService' object has no attribute '_build_prompt'

tests/unit/test_gemini.py:24: AttributeError
______________________________________ test_validate_required_fields _______________________________________

gemini_service = <app.services.gemini.GeminiService object at 0x705cad78b4f0>

    def test_validate_required_fields(gemini_service):
        """å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ¤œè¨¼ã®ãƒ†ã‚¹ãƒˆ"""
        # æ­£å¸¸ç³»
        data = {'name': 'AI', 'type': 'TECHNOLOGY'}
        required_fields = {'name', 'type'}
>       gemini_service._validate_required_fields(data, required_fields)
E       AttributeError: 'GeminiService' object has no attribute '_validate_required_fields'

tests/unit/test_gemini.py:37: AttributeError
________________________________________ test_validate_value_range _________________________________________

gemini_service = <app.services.gemini.GeminiService object at 0x705cad7c39a0>

    def test_validate_value_range(gemini_service):
        """å€¤ã®ç¯„å›²æ¤œè¨¼ã®ãƒ†ã‚¹ãƒˆ"""
        # æ­£å¸¸ç³»
>       gemini_service._validate_value_range(0.5, 0.0, 1.0, 'test_field')
E       AttributeError: 'GeminiService' object has no attribute '_validate_value_range'

tests/unit/test_gemini.py:52: AttributeError
______________________________________ test_validate_analysis_result _______________________________________

gemini_service = <app.services.gemini.GeminiService object at 0x705cad8612d0>

    def test_validate_analysis_result(gemini_service):
        """è§£æçµæœæ¤œè¨¼ã®ãƒ†ã‚¹ãƒˆ"""
        # æ­£å¸¸ç³»
        valid_result = {
            'entities': [
                {
                    'type': 'TECHNOLOGY',
                    'name': 'AI',
                    'description': 'äººå·¥çŸ¥èƒ½æŠ€è¡“'
                }
            ],
            'relationships': [],
            'summary': 'ãƒ†ã‚¹ãƒˆ',
            'relevance_market_impact': 0.8,
            'relevance_timeliness': 0.7,
            'relevance_credibility': 0.9,
            'quality_completeness': 0.8,
            'quality_objectivity': 0.7,
            'quality_detail_level': 0.6
        }
>       gemini_service._validate_analysis_result(valid_result)
E       AttributeError: 'GeminiService' object has no attribute '_validate_analysis_result'

tests/unit/test_gemini.py:79: AttributeError
_______________________________________ test_validate_relationships ________________________________________

gemini_service = <app.services.gemini.GeminiService object at 0x705cad76add0>

    def test_validate_relationships(gemini_service):
        """é–¢ä¿‚æ€§æ¤œè¨¼ã®ãƒ†ã‚¹ãƒˆ"""
        # æ­£å¸¸ç³»
        valid_relationships = [
            {
                'type': 'INFLUENCES',
                'source': 'AI',
                'target': 'Market',
                'description': 'ãƒ†ã‚¹ãƒˆ',
                'confidence': 0.8
            }
        ]
>       gemini_service._validate_relationships(valid_relationships)
E       AttributeError: 'GeminiService' object has no attribute '_validate_relationships'

tests/unit/test_gemini.py:124: AttributeError
_______________________________________ test_validate_impact_scores ________________________________________

gemini_service = <app.services.gemini.GeminiService object at 0x705cad7d0d00>

    def test_validate_impact_scores(gemini_service):
        """å½±éŸ¿åº¦ã‚¹ã‚³ã‚¢æ¤œè¨¼ã®ãƒ†ã‚¹ãƒˆ"""
        # æ­£å¸¸ç³»
        valid_scores = {
            'market_size': 0.8,
            'technology_trends': 0.7,
            'competitive_landscape': 0.6,
            'regulatory_environment': 0.5,
            'investment_trends': 0.4
        }
>       gemini_service._validate_impact_scores(valid_scores)
E       AttributeError: 'GeminiService' object has no attribute '_validate_impact_scores'

tests/unit/test_gemini.py:161: AttributeError
_______________________________________ test_call_gemini_with_retry ________________________________________

gemini_service = <app.services.gemini.GeminiService object at 0x705cad7b7af0>
mock_genai = <MagicMock name='genai' id='123543349482432'>

    @pytest.mark.asyncio
    async def test_call_gemini_with_retry(gemini_service, mock_genai):
        """Gemini APIå‘¼ã³å‡ºã—ã®ãƒªãƒˆãƒ©ã‚¤ãƒ†ã‚¹ãƒˆ"""
        # æ­£å¸¸ç³»
        mock_genai.GenerativeModel.return_value.generate_content.return_value.text = '{"test": "data"}'
>       result = await gemini_service._call_gemini_with_retry("test prompt")
E       AttributeError: 'GeminiService' object has no attribute '_call_gemini_with_retry'

tests/unit/test_gemini.py:189: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
------------------------------------------ Captured log teardown -------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
___________________________________________ test_analyze_content ___________________________________________

gemini_service = <app.services.gemini.GeminiService object at 0x705cad860e80>
mock_genai = <MagicMock name='genai' id='123543349803760'>

    @pytest.mark.asyncio
    async def test_analyze_content(gemini_service, mock_genai):
        """ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è§£æã®ãƒ†ã‚¹ãƒˆ"""
        # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
        content = "ãƒ†ã‚¹ãƒˆç”¨ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„"
        context = "å¸‚å ´åˆ†æã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ"
    
        # ãƒ¢ãƒƒã‚¯ã®æˆ»ã‚Šå€¤ã‚’è¨­å®š
        expected_result = {
            'entities': [
                {
                    'type': 'TECHNOLOGY',
                    'name': 'AI',
                    'description': 'äººå·¥çŸ¥èƒ½æŠ€è¡“'
                }
            ],
            'relationships': [],
            'summary': 'AIã¨æ©Ÿæ¢°å­¦ç¿’ã®é–¢ä¿‚æ€§',
            'relevance_market_impact': 0.8,
            'relevance_timeliness': 0.7,
            'relevance_credibility': 0.9,
            'quality_completeness': 0.8,
            'quality_objectivity': 0.7,
            'quality_detail_level': 0.6
        }
    
        mock_genai.GenerativeModel.return_value.generate_content.return_value.text = json.dumps(expected_res
ult)
    
        # é–¢æ•°ã‚’å®Ÿè¡Œ
>       result = await gemini_service.analyze_content(content, context)

tests/unit/test_gemini.py:233: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.services.gemini.GeminiService object at 0x705cad860e80>, content = 'ãƒ†ã‚¹ãƒˆç”¨ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„'
context = 'å¸‚å ´åˆ†æã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ'

    async def analyze_content(self, content: str, context: str) -> Dict:
        """ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è§£æ
    
        Args:
            content (str): è§£æå¯¾è±¡ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
            context (str): è§£æã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
    
        Returns:
            Dict: è§£æçµæœ
        """
        try:
            # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ä½œæˆ
            prompt = f"""
            ä»¥ä¸‹ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è§£æã—ã€å¸‚å ´åˆ†æã«é–¢é€£ã™ã‚‹æƒ…å ±ã‚’æŠ½å‡ºã—ã¦ãã ã•ã„ã€‚
    
            ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼š
            {context}
    
            ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼š
            {content}
    
            ä»¥ä¸‹ã®å½¢å¼ã§JSONå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ï¼š
            - entities: ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒªã‚¹ãƒˆï¼ˆä¼æ¥­ã€æŠ€è¡“ã€å¸‚å ´ãªã©ï¼‰
            - relationships: ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£é–“ã®é–¢ä¿‚æ€§
            - summary: è¦ç´„
            - relevance_market_impact: å¸‚å ´ã¸ã®å½±éŸ¿åº¦ï¼ˆ0.0ï½1.0ï¼‰
            - relevance_timeliness: æ™‚å®œæ€§ï¼ˆ0.0ï½1.0ï¼‰
            - relevance_credibility: ä¿¡é ¼æ€§ï¼ˆ0.0ï½1.0ï¼‰
            - quality_completeness: å®Œå…¨æ€§ï¼ˆ0.0ï½1.0ï¼‰
            - quality_objectivity: å®¢è¦³æ€§ï¼ˆ0.0ï½1.0ï¼‰
            - quality_detail_level: è©³ç´°åº¦ï¼ˆ0.0ï½1.0ï¼‰
            """
    
            # Geminiã«ã‚ˆã‚‹è§£æ
>           response = await self.model.generate_content_async(prompt)
E           TypeError: object Mock can't be used in 'await' expression

app/services/gemini.py:55: TypeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
-------------------------------------------- Captured log call ---------------------------------------------
ERROR    app.services.gemini:gemini.py:63 Geminiè§£æã‚¨ãƒ©ãƒ¼: object Mock can't be used in 'await' expression
------------------------------------------ Captured log teardown -------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
________________________________________ test_extract_relationships ________________________________________

gemini_service = <app.services.gemini.GeminiService object at 0x705cad75c730>
mock_genai = <MagicMock name='genai' id='123543349533648'>

    @pytest.mark.asyncio
    async def test_extract_relationships(gemini_service, mock_genai):
        """é–¢ä¿‚æ€§æŠ½å‡ºã®ãƒ†ã‚¹ãƒˆ"""
        # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
        content = {
            'entities': [
                {
                    'type': 'TECHNOLOGY',
                    'name': 'AI',
                    'description': 'äººå·¥çŸ¥èƒ½æŠ€è¡“'
                }
            ],
            'summary': 'AIã®å¸‚å ´å‹•å‘'
        }
    
        context = {
            'entities': [
                {
                    'type': 'MARKET',
                    'name': 'AIå¸‚å ´',
                    'description': 'AIé–¢é€£ã®å¸‚å ´'
                }
            ],
            'relationships': []
        }
    
        # ãƒ¢ãƒƒã‚¯ã®æˆ»ã‚Šå€¤ã‚’è¨­å®š
        expected_result = [
            {
                'type': 'INFLUENCES',
                'source': 'AI',
                'target': 'AIå¸‚å ´',
                'description': 'æŠ€è¡“ãŒå¸‚å ´ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹',
                'confidence': 0.8
            }
        ]
    
        mock_genai.GenerativeModel.return_value.generate_content.return_value.text = json.dumps(expected_res
ult)
    
        # é–¢æ•°ã‚’å®Ÿè¡Œ
>       result = await gemini_service.extract_relationships(content, context)

tests/unit/test_gemini.py:284: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.services.gemini.GeminiService object at 0x705cad75c730>
content = {'entities': [{'description': 'äººå·¥çŸ¥èƒ½æŠ€è¡“', 'name': 'AI', 'type': 'TECHNOLOGY'}], 'summary': 'AI
ã®å¸‚å ´å‹•å‘'}
context = {'entities': [{'description': 'AIé–¢é€£ã®å¸‚å ´', 'name': 'AIå¸‚å ´', 'type': 'MARKET'}], 'relationships
': []}

    async def extract_relationships(
        self,
        content: Dict,
        context: Dict
    ) -> List[Dict]:
        """é–¢ä¿‚æ€§ã‚’æŠ½å‡º
    
        Args:
            content (Dict): è§£ææ¸ˆã¿ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
            context (Dict): è§£æã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
    
        Returns:
            List[Dict]: æŠ½å‡ºã•ã‚ŒãŸé–¢ä¿‚æ€§ã®ãƒªã‚¹ãƒˆ
        """
        try:
            # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ä½œæˆ
            prompt = f"""
            ä»¥ä¸‹ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‹ã‚‰ã€ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£é–“ã®é–¢ä¿‚æ€§ã‚’æŠ½å‡ºã—ã¦ãã ã•ã„ã€‚
    
            ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼š
            {content}
    
            æ—¢å­˜ã®é–¢ä¿‚æ€§ï¼š
            {context.get('relationships', [])}
    
            ä»¥ä¸‹ã®å½¢å¼ã§JSONå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ï¼š
            - type: é–¢ä¿‚æ€§ã®ç¨®é¡ï¼ˆINFLUENCES, COMPETES, DEVELOPS, PARTICIPATESï¼‰
            - source: é–¢ä¿‚æ€§ã®ä¸»ä½“
            - target: é–¢ä¿‚æ€§ã®å¯¾è±¡
            - description: é–¢ä¿‚æ€§ã®èª¬æ˜
            - confidence: ç¢ºä¿¡åº¦ï¼ˆ0.0ï½1.0ï¼‰
            """
    
            # Geminiã«ã‚ˆã‚‹æŠ½å‡º
>           response = await self.model.generate_content_async(prompt)
E           TypeError: object Mock can't be used in 'await' expression

app/services/gemini.py:100: TypeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
-------------------------------------------- Captured log call ---------------------------------------------
ERROR    app.services.gemini:gemini.py:108 Geminié–¢ä¿‚æ€§æŠ½å‡ºã‚¨ãƒ©ãƒ¼: object Mock can't be used in 'await' expr
ession
------------------------------------------ Captured log teardown -------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
_______________________________________ test_evaluate_market_impact ________________________________________

gemini_service = <app.services.gemini.GeminiService object at 0x705cad863e80>
mock_genai = <MagicMock name='genai' id='123543349902592'>

    @pytest.mark.asyncio
    async def test_evaluate_market_impact(gemini_service, mock_genai):
        """å¸‚å ´å½±éŸ¿åº¦è©•ä¾¡ã®ãƒ†ã‚¹ãƒˆ"""
        # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
        content = {
            'entities': [
                {
                    'type': 'TECHNOLOGY',
                    'name': 'AI',
                    'description': 'äººå·¥çŸ¥èƒ½æŠ€è¡“'
                }
            ],
            'summary': 'AIã®å¸‚å ´ã¸ã®å½±éŸ¿'
        }
    
        # ãƒ¢ãƒƒã‚¯ã®æˆ»ã‚Šå€¤ã‚’è¨­å®š
        expected_result = {
            'market_size': 0.8,
            'technology_trends': 0.9,
            'competitive_landscape': 0.7,
            'regulatory_environment': 0.6,
            'investment_trends': 0.7
        }
    
        mock_genai.GenerativeModel.return_value.generate_content.return_value.text = json.dumps(expected_res
ult)
    
        # é–¢æ•°ã‚’å®Ÿè¡Œ
>       result = await gemini_service.evaluate_market_impact(content)

tests/unit/test_gemini.py:322: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.services.gemini.GeminiService object at 0x705cad863e80>
content = {'entities': [{'description': 'äººå·¥çŸ¥èƒ½æŠ€è¡“', 'name': 'AI', 'type': 'TECHNOLOGY'}], 'summary': 'AI
ã®å¸‚å ´ã¸ã®å½±éŸ¿'}

    async def evaluate_market_impact(self, content: Dict) -> Dict:
        """å¸‚å ´å½±éŸ¿åº¦ã‚’è©•ä¾¡
    
        Args:
            content (Dict): è§£ææ¸ˆã¿ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
    
        Returns:
            Dict: è©•ä¾¡çµæœ
        """
        try:
            # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ä½œæˆ
            prompt = f"""
            ä»¥ä¸‹ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‹ã‚‰ã€å¸‚å ´ã¸ã®å½±éŸ¿åº¦ã‚’è©•ä¾¡ã—ã¦ãã ã•ã„ã€‚
    
            ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼š
            {content}
    
            ä»¥ä¸‹ã®è¦³ç‚¹ã§0.0ï½1.0ã®å€¤ã‚’è©•ä¾¡ã—ã€JSONå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ï¼š
            - market_size: å¸‚å ´è¦æ¨¡ã¸ã®å½±éŸ¿
            - technology_trends: æŠ€è¡“ãƒˆãƒ¬ãƒ³ãƒ‰ã¸ã®å½±éŸ¿
            - competitive_landscape: ç«¶äº‰ç’°å¢ƒã¸ã®å½±éŸ¿
            - regulatory_environment: è¦åˆ¶ç’°å¢ƒã¸ã®å½±éŸ¿
            - investment_trends: æŠ•è³‡å‹•å‘ã¸ã®å½±éŸ¿
            """
    
            # Geminiã«ã‚ˆã‚‹è©•ä¾¡
>           response = await self.model.generate_content_async(prompt)
E           TypeError: object Mock can't be used in 'await' expression

app/services/gemini.py:137: TypeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
-------------------------------------------- Captured log call ---------------------------------------------
ERROR    app.services.gemini:gemini.py:145 Geminiå¸‚å ´å½±éŸ¿åº¦è©•ä¾¡ã‚¨ãƒ©ãƒ¼: object Mock can't be used in 'await' 
expression
------------------------------------------ Captured log teardown -------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
_______________________________________________ test_connect _______________________________________________

mock_driver = <MagicMock name='AsyncGraphDatabase' id='123543349890736'>

    @pytest.mark.asyncio
    async def test_connect(mock_driver):
        """æ¥ç¶šã®ãƒ†ã‚¹ãƒˆ"""
>       connection = Neo4jConnection()

tests/unit/test_neo4j.py:25: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.db.neo4j.Neo4jConnection object at 0x705cad7d07f0>

    def __init__(self):
        """åˆæœŸåŒ–"""
>       self.uri = settings.NEO4J_URI
E       AttributeError: module 'app.config.settings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER
'?

app/db/neo4j.py:13: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
------------------------------------------ Captured log teardown -------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
__________________________________________ test_connection_error ___________________________________________

mock_driver = <MagicMock name='AsyncGraphDatabase' id='123543348539216'>

    @pytest.mark.asyncio
    async def test_connection_error(mock_driver):
        """æ¥ç¶šã‚¨ãƒ©ãƒ¼ã®ãƒ†ã‚¹ãƒˆ"""
        # ãƒ¢ãƒƒã‚¯ã«ã‚¨ãƒ©ãƒ¼ã‚’è¨­å®š
        mock_driver.driver.return_value.verify_connectivity.side_effect = Exception("Connection Error")
    
>       connection = Neo4jConnection()

tests/unit/test_neo4j.py:295: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.db.neo4j.Neo4jConnection object at 0x705cad668670>

    def __init__(self):
        """åˆæœŸåŒ–"""
>       self.uri = settings.NEO4J_URI
E       AttributeError: module 'app.config.settings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER
'?

app/db/neo4j.py:13: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
------------------------------------------ Captured log teardown -------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
___________________________________________ test_extract_content ___________________________________________

    @pytest.mark.asyncio
    async def test_extract_content():
        crawler = WebCrawlerService()
        html = """
        <html>
            <head>
                <title>ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸</title>
                <meta name="description" content="ãƒ†ã‚¹ãƒˆèª¬æ˜">
            </head>
            <body>
                <nav>ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆé™¤å¤–å¯¾è±¡ï¼‰</nav>
                <h1>ãƒ¡ã‚¤ãƒ³ã‚¿ã‚¤ãƒˆãƒ«</h1>
                <p>æœ¬æ–‡ãƒ†ã‚­ã‚¹ãƒˆ</p>
                <aside>ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼ˆé™¤å¤–å¯¾è±¡ï¼‰</aside>
            </body>
        </html>
        """
    
>       result = await crawler.extract_content(html)
E       AttributeError: 'WebCrawlerService' object has no attribute 'extract_content'. Did you mean: '_extra
ct_content'?

tests/unit/test_web_crawler.py:32: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
-------------------------------------------- Captured log call ---------------------------------------------
INFO     app.services.web:web.py:23 WebCrawlerServiceã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸ
------------------------------------------ Captured log teardown -------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
========================================= short test summary info ==========================================
FAILED tests/unit/test_gemini.py::test_build_prompt - AttributeError: 'GeminiService' object has no attribut
e '_build_prompt'
FAILED tests/unit/test_gemini.py::test_validate_required_fields - AttributeError: 'GeminiService' object has
 no attribute '_validate_required_fields'
FAILED tests/unit/test_gemini.py::test_validate_value_range - AttributeError: 'GeminiService' object has no 
attribute '_validate_value_range'
FAILED tests/unit/test_gemini.py::test_validate_analysis_result - AttributeError: 'GeminiService' object has
 no attribute '_validate_analysis_result'
FAILED tests/unit/test_gemini.py::test_validate_relationships - AttributeError: 'GeminiService' object has n
o attribute '_validate_relationships'
FAILED tests/unit/test_gemini.py::test_validate_impact_scores - AttributeError: 'GeminiService' object has n
o attribute '_validate_impact_scores'
FAILED tests/unit/test_gemini.py::test_call_gemini_with_retry - AttributeError: 'GeminiService' object has n
o attribute '_call_gemini_with_retry'
FAILED tests/unit/test_gemini.py::test_analyze_content - TypeError: object Mock can't be used in 'await' exp
ression
FAILED tests/unit/test_gemini.py::test_extract_relationships - TypeError: object Mock can't be used in 'awai
t' expression
FAILED tests/unit/test_gemini.py::test_evaluate_market_impact - TypeError: object Mock can't be used in 'awa
it' expression
FAILED tests/unit/test_neo4j.py::test_connect - AttributeError: module 'app.config.settings' has no attribut
e 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
FAILED tests/unit/test_neo4j.py::test_connection_error - AttributeError: module 'app.config.settings' has no
 attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
FAILED tests/unit/test_web_crawler.py::test_extract_content - AttributeError: 'WebCrawlerService' object has
 no attribute 'extract_content'. Did you mean: '_extract_...
ERROR tests/unit/test_analyzer.py::test_analyze_content - AttributeError: module 'app.config.settings' has n
o attribute 'CONTENT_ANALYSIS_CRITERIA'
ERROR tests/unit/test_analyzer.py::test_extract_relationships - AttributeError: module 'app.config.settings'
 has no attribute 'CONTENT_ANALYSIS_CRITERIA'
ERROR tests/unit/test_analyzer.py::test_evaluate_market_impact - AttributeError: module 'app.config.settings
' has no attribute 'CONTENT_ANALYSIS_CRITERIA'
ERROR tests/unit/test_crawler.py::test_crawl - TypeError: AdoptiveMarketCrawler.__init__() missing 1 require
d positional argument: 'knowledge_manager'
ERROR tests/unit/test_crawler.py::test_crawl_with_error - TypeError: AdoptiveMarketCrawler.__init__() missin
g 1 required positional argument: 'knowledge_manager'
ERROR tests/unit/test_crawler.py::test_run - TypeError: AdoptiveMarketCrawler.__init__() missing 1 required 
positional argument: 'knowledge_manager'
ERROR tests/unit/test_knowledge.py::test_add_knowledge - AttributeError: module 'app.config.settings' has no
 attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_knowledge.py::test_query_related_knowledge - AttributeError: module 'app.config.settin
gs' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_knowledge.py::test_update_relationships - AttributeError: module 'app.config.settings'
 has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j.py::test_close - AttributeError: module 'app.config.settings' has no attribute '
NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j.py::test_create_node - AttributeError: module 'app.config.settings' has no attri
bute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j.py::test_create_relationship - AttributeError: module 'app.config.settings' has 
no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j.py::test_find_node - AttributeError: module 'app.config.settings' has no attribu
te 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j.py::test_get_relationship - AttributeError: module 'app.config.settings' has no 
attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j.py::test_update_relationship - AttributeError: module 'app.config.settings' has 
no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j.py::test_run_query - AttributeError: module 'app.config.settings' has no attribu
te 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j.py::test_query_error - AttributeError: module 'app.config.settings' has no attri
bute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j_connection.py::test_connect - AttributeError: module 'app.config.settings' has n
o attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j_connection.py::test_create_node - AttributeError: module 'app.config.settings' h
as no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j_connection.py::test_create_relationship - AttributeError: module 'app.config.set
tings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j_connection.py::test_find_node - AttributeError: module 'app.config.settings' has
 no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j_connection.py::test_connection_error - AttributeError: module 'app.config.settin
gs' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j_connection.py::test_close - AttributeError: module 'app.config.settings' has no 
attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_search.py::test_search_with_all_types - AttributeError: module 'app.config.settings' h
as no attribute 'USER_AGENT'
ERROR tests/unit/test_search.py::test_search_with_specific_type - AttributeError: module 'app.config.setting
s' has no attribute 'USER_AGENT'
ERROR tests/unit/test_search.py::test_search_with_invalid_type - AttributeError: module 'app.config.settings
' has no attribute 'USER_AGENT'
ERROR tests/unit/test_search.py::test_content_filtering - AttributeError: module 'app.config.settings' has n
o attribute 'USER_AGENT'
ERROR tests/unit/test_search.py::test_concurrent_searches - AttributeError: module 'app.config.settings' has
 no attribute 'USER_AGENT'
ERROR tests/unit/test_web_crawler.py::test_fetch_url_success - AttributeError: 'WebCrawlerService' object ha
s no attribute 'start_session'
ERROR tests/unit/test_web_crawler.py::test_fetch_url_retry_on_rate_limit - AttributeError: 'WebCrawlerServic
e' object has no attribute 'start_session'
ERROR tests/unit/test_web_crawler.py::test_crawl_urls - AttributeError: 'WebCrawlerService' object has no at
tribute 'start_session'
ERROR tests/unit/test_web_crawler.py::test_fetch_url_error_handling - AttributeError: 'WebCrawlerService' ob
ject has no attribute 'start_session'
ERROR tests/unit/test_web_crawler.py::test_crawl_urls_partial_failure - AttributeError: 'WebCrawlerService' 
object has no attribute 'start_session'
================================= 13 failed, 4 passed, 33 errors in 1.58s ==================================
devuser@f82d54057b41:~/workspace$
```

---



ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã®çµæœã€ã„ãã¤ã‹ã®å•é¡ŒãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼š

1. è¨­å®šé–¢é€£ã®å•é¡Œï¼š
   - `NEO4J_URI`ãŒ`settings`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å®šç¾©ã•ã‚Œã¦ã„ãªã„
   - `USER_AGENT`ãŒ`settings`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å®šç¾©ã•ã‚Œã¦ã„ãªã„
   - `CONTENT_ANALYSIS_CRITERIA`ãŒ`settings`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å®šç¾©ã•ã‚Œã¦ã„ãªã„

2. ã‚¯ãƒ©ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰é–¢é€£ã®å•é¡Œï¼š
   - `GeminiService`ã‚¯ãƒ©ã‚¹ã«å¿…è¦ãªãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„
   - `WebCrawlerService`ã‚¯ãƒ©ã‚¹ã«å¿…è¦ãªãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„

ã¾ãšã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å•é¡Œã‹ã‚‰ä¿®æ­£ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

---

Read file: app/config/settings.py

---



è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«å¿…è¦ãªè¨­å®šã‚’è¿½åŠ ã—ã¾ã™ã€‚

---

```diff
  NEO4J_USER = os.getenv('neo4j_user')
  NEO4J_PASS = os.getenv('neo4j_pswd')
+ NEO4J_URI = f"bolt://{NEO4J_HOST}:7687"  # Neo4jã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒãƒ¼ãƒˆ
  
  if not NEO4J_USER or not NEO4J_PASS:
      raise ValueError("Neo4j credentials are required")
+ 
+ # ã‚¯ãƒ­ãƒ¼ãƒ©ãƒ¼è¨­å®š
+ USER_AGENT = "Adoptive Market Crawler/1.0"
+ REQUEST_TIMEOUT = 30  # ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆç§’ï¼‰
+ MAX_RETRIES = 3      # æœ€å¤§ãƒªãƒˆãƒ©ã‚¤å›æ•°
+ RETRY_DELAY = 5      # ãƒªãƒˆãƒ©ã‚¤é–“éš”ï¼ˆç§’ï¼‰
+ 
+ # ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è§£æè¨­å®š
+ CONTENT_ANALYSIS_CRITERIA = {
+     'relevance': {
+         'market_impact': {'min': 0.0, 'max': 1.0},
+         'timeliness': {'min': 0.0, 'max': 1.0},
+         'credibility': {'min': 0.0, 'max': 1.0}
+     },
+     'quality': {
+         'completeness': {'min': 0.0, 'max': 1.0},
+         'objectivity': {'min': 0.0, 'max': 1.0},
+         'detail_level': {'min': 0.0, 'max': 1.0}
+     }
+ }
+ 
+ # å¸‚å ´å½±éŸ¿åº¦è©•ä¾¡åŸºæº–
+ MARKET_IMPACT_CRITERIA = {
+     'market_size': {'min': 0.0, 'max': 1.0},
+     'technology_trends': {'min': 0.0, 'max': 1.0},
+     'competitive_landscape': {'min': 0.0, 'max': 1.0},
+     'regulatory_environment': {'min': 0.0, 'max': 1.0},
+     'investment_trends': {'min': 0.0, 'max': 1.0}
+ }
+ 
+ # é–¢ä¿‚æ€§ã‚¿ã‚¤ãƒ—
+ RELATIONSHIP_TYPES = [
+     'INFLUENCES',    # å½±éŸ¿ã‚’ä¸ãˆã‚‹
+     'COMPETES',     # ç«¶åˆé–¢ä¿‚
+     'DEVELOPS',     # é–‹ç™ºé–¢ä¿‚
+     'PARTICIPATES'  # å‚åŠ é–¢ä¿‚
+ ]
  
```

---



---



---

