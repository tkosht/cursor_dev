<!-- Generated by SpecStory -->

# プロダクト開発の要件確認 (2025-01-05 19:03:40)

_**User**_

ワークフローと@development_rules.md に従い、 @requirements.md の要件を満たすプロダクトの開発をお願いいたします。

---

_**Assistant**_

はい、承知いたしました。ワークフロー定義に従って開発を進めていきます。

まず、ステップ0から始めましょう。

要件定義書、基本設計書、詳細設計書の内容を確認させていただきます。

---

<details>
            <summary>Listed directory docs/02.basic_design • **1** results</summary>
        
| Name |
|-------|
| 📄 `basic_design.md` |

</details>

---

<details>
            <summary>Listed directory docs/03.detail_design • **1** results</summary>
        
| Name |
|-------|
| 📄 `detail_design.md` |

</details>

---



基本設計書と詳細設計書の内容を確認させていただきます。

---

Read file: docs/02.basic_design/basic_design.md

---

Read file: docs/03.detail_design/detail_design.md

---



要件定義書、基本設計書、詳細設計書を確認しました。次に、進捗状況を確認します。

---

<details>
            <summary>Listed directory docs/31.progress • **4** results</summary>
        
| Name |
|-------|
| 📄 `2025-01-05-18-38-39.md` |
| 📄 `2025-01-05-16-34-28.md` |
| 📄 `2025-01-05-16-31-26.md` |
| 📄 `2025-01-05-15-43-11.md` |

</details>

---



最新の進捗ファイルを確認します。

---

Read file: docs/31.progress/2025-01-05-18-38-39.md

---



進捗状況を確認しました。次のステップとして、テストの実行と結果の確認が予定されています。

まず、プロジェクトの構造を確認し、必要なファイルが存在するか確認します。

---

<details>
            <summary>Listed current directory • **32** results</summary>
        
| Name |
|-------|
| 📄 `pyproject.toml` |
| 📄 `.env` |
| 📄 `.coverage` |
| 📄 `poetry.lock` |
| 📁 `tests` |
| 📁 `config` |
| 📄 `pytest.ini` |
| 📁 `app` |
| 📁 `.git` |
| 📁 `docs` |
| 📄 `compose.override.yml` |
| 📁 `docker` |
| 📁 `data` |
| 📄 `.cursorrules` |
| 📄 `.gitignore` |
| 📄 `.cursorban` |
| 📄 `README.md` |
| 📄 `.flake8` |
| 📁 `.ssh` |
| 📄 `compose.yml` |
| 📄 `Makefile` |
| 📁 `.pytest_cache` |
| 📁 `.venv` |
| 📁 `notebooks` |
| 📁 `bin` |
| 📁 `.vscode` |
| 📁 `.github` |
| 📁 `.devcontainer` |
| 📄 `cursor_dev.code-workspace` |
| 📄 `.dockerignore` |
| 📄 `LICENSE` |
| 📁 `rc` |

</details>

---

<details>
            <summary>Listed directory app • **7** results</summary>
        
| Name |
|-------|
| 📁 `core` |
| 📁 `services` |
| 📁 `config` |
| 📁 `db` |
| 📁 `examples` |
| 📁 `__pycache__` |
| 📄 `__init__.py` |

</details>

---

<details>
            <summary>Listed directory tests • **4** results</summary>
        
| Name |
|-------|
| 📁 `unit` |
| 📁 `__pycache__` |
| 📄 `conftest.py` |
| 📁 `integration` |

</details>

---



プロジェクトの構造を確認しました。次に、テストを実行する前に、pytest.iniの設定を確認します。

---

Read file: pytest.ini

---



次に、テストを実行します。まずは単体テストから実行します。

---

```bash
poetry run pytest tests/unit/ -v
```

```
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
_____________________________________ ERROR at setup of test_find_node _____________________________________

mock_driver = <MagicMock name='AsyncGraphDatabase' id='123543349534224'>

    @pytest.fixture
    async def neo4j_connection(mock_driver):
        """Neo4jConnectionのインスタンス"""
>       connection = Neo4jConnection()

tests/unit/test_neo4j.py:18: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.db.neo4j.Neo4jConnection object at 0x705cad75fd30>

    def __init__(self):
        """初期化"""
>       self.uri = settings.NEO4J_URI
E       AttributeError: module 'app.config.settings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER
'?

app/db/neo4j.py:13: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
_________________________________ ERROR at setup of test_get_relationship __________________________________

mock_driver = <MagicMock name='AsyncGraphDatabase' id='123543348222880'>

    @pytest.fixture
    async def neo4j_connection(mock_driver):
        """Neo4jConnectionのインスタンス"""
>       connection = Neo4jConnection()

tests/unit/test_neo4j.py:18: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.db.neo4j.Neo4jConnection object at 0x705cad7b6bc0>

    def __init__(self):
        """初期化"""
>       self.uri = settings.NEO4J_URI
E       AttributeError: module 'app.config.settings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER
'?

app/db/neo4j.py:13: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
________________________________ ERROR at setup of test_update_relationship ________________________________

mock_driver = <MagicMock name='AsyncGraphDatabase' id='123543349349536'>

    @pytest.fixture
    async def neo4j_connection(mock_driver):
        """Neo4jConnectionのインスタンス"""
>       connection = Neo4jConnection()

tests/unit/test_neo4j.py:18: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.db.neo4j.Neo4jConnection object at 0x705cad7dc280>

    def __init__(self):
        """初期化"""
>       self.uri = settings.NEO4J_URI
E       AttributeError: module 'app.config.settings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER
'?

app/db/neo4j.py:13: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
_____________________________________ ERROR at setup of test_run_query _____________________________________

mock_driver = <MagicMock name='AsyncGraphDatabase' id='123543349846720'>

    @pytest.fixture
    async def neo4j_connection(mock_driver):
        """Neo4jConnectionのインスタンス"""
>       connection = Neo4jConnection()

tests/unit/test_neo4j.py:18: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.db.neo4j.Neo4jConnection object at 0x705cad62abf0>

    def __init__(self):
        """初期化"""
>       self.uri = settings.NEO4J_URI
E       AttributeError: module 'app.config.settings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER
'?

app/db/neo4j.py:13: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
____________________________________ ERROR at setup of test_query_error ____________________________________

mock_driver = <MagicMock name='AsyncGraphDatabase' id='123543348416944'>

    @pytest.fixture
    async def neo4j_connection(mock_driver):
        """Neo4jConnectionのインスタンス"""
>       connection = Neo4jConnection()

tests/unit/test_neo4j.py:18: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.db.neo4j.Neo4jConnection object at 0x705cad628f40>

    def __init__(self):
        """初期化"""
>       self.uri = settings.NEO4J_URI
E       AttributeError: module 'app.config.settings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER
'?

app/db/neo4j.py:13: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
______________________________________ ERROR at setup of test_connect ______________________________________

    @pytest.fixture
    async def neo4j_connection():
        """Neo4jConnectionのフィクスチャ"""
>       connection = Neo4jConnection()

tests/unit/test_neo4j_connection.py:8: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.db.neo4j.Neo4jConnection object at 0x705cad66ab00>

    def __init__(self):
        """初期化"""
>       self.uri = settings.NEO4J_URI
E       AttributeError: module 'app.config.settings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER
'?

app/db/neo4j.py:13: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
____________________________________ ERROR at setup of test_create_node ____________________________________

    @pytest.fixture
    async def neo4j_connection():
        """Neo4jConnectionのフィクスチャ"""
>       connection = Neo4jConnection()

tests/unit/test_neo4j_connection.py:8: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.db.neo4j.Neo4jConnection object at 0x705cad628100>

    def __init__(self):
        """初期化"""
>       self.uri = settings.NEO4J_URI
E       AttributeError: module 'app.config.settings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER
'?

app/db/neo4j.py:13: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
________________________________ ERROR at setup of test_create_relationship ________________________________

    @pytest.fixture
    async def neo4j_connection():
        """Neo4jConnectionのフィクスチャ"""
>       connection = Neo4jConnection()

tests/unit/test_neo4j_connection.py:8: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.db.neo4j.Neo4jConnection object at 0x705cad647eb0>

    def __init__(self):
        """初期化"""
>       self.uri = settings.NEO4J_URI
E       AttributeError: module 'app.config.settings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER
'?

app/db/neo4j.py:13: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
_____________________________________ ERROR at setup of test_find_node _____________________________________

    @pytest.fixture
    async def neo4j_connection():
        """Neo4jConnectionのフィクスチャ"""
>       connection = Neo4jConnection()

tests/unit/test_neo4j_connection.py:8: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.db.neo4j.Neo4jConnection object at 0x705cad7b53f0>

    def __init__(self):
        """初期化"""
>       self.uri = settings.NEO4J_URI
E       AttributeError: module 'app.config.settings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER
'?

app/db/neo4j.py:13: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
_________________________________ ERROR at setup of test_connection_error __________________________________

    @pytest.fixture
    async def neo4j_connection():
        """Neo4jConnectionのフィクスチャ"""
>       connection = Neo4jConnection()

tests/unit/test_neo4j_connection.py:8: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.db.neo4j.Neo4jConnection object at 0x705cad68c0d0>

    def __init__(self):
        """初期化"""
>       self.uri = settings.NEO4J_URI
E       AttributeError: module 'app.config.settings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER
'?

app/db/neo4j.py:13: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
_______________________________________ ERROR at setup of test_close _______________________________________

    @pytest.fixture
    async def neo4j_connection():
        """Neo4jConnectionのフィクスチャ"""
>       connection = Neo4jConnection()

tests/unit/test_neo4j_connection.py:8: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.db.neo4j.Neo4jConnection object at 0x705cad629240>

    def __init__(self):
        """初期化"""
>       self.uri = settings.NEO4J_URI
E       AttributeError: module 'app.config.settings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER
'?

app/db/neo4j.py:13: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
_______________________________ ERROR at setup of test_search_with_all_types _______________________________

    @pytest.fixture
    async def search_engine():
        """テスト用のMarketSearchEngineインスタンスを作成"""
>       engine = MarketSearchEngine()

tests/unit/test_search.py:10: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.core.search.MarketSearchEngine object at 0x705cad7b41f0>

    def __init__(self):
        """初期化"""
        self.session = None
        self.search_providers = {
            'news': self._search_news,
            'research': self._search_research,
            'company': self._search_company,
            'social': self._search_social,
        }
        self.headers = {
>           'User-Agent': settings.USER_AGENT
        }
E       AttributeError: module 'app.config.settings' has no attribute 'USER_AGENT'

app/core/search.py:24: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
_____________________________ ERROR at setup of test_search_with_specific_type _____________________________

    @pytest.fixture
    async def search_engine():
        """テスト用のMarketSearchEngineインスタンスを作成"""
>       engine = MarketSearchEngine()

tests/unit/test_search.py:10: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.core.search.MarketSearchEngine object at 0x705cad647280>

    def __init__(self):
        """初期化"""
        self.session = None
        self.search_providers = {
            'news': self._search_news,
            'research': self._search_research,
            'company': self._search_company,
            'social': self._search_social,
        }
        self.headers = {
>           'User-Agent': settings.USER_AGENT
        }
E       AttributeError: module 'app.config.settings' has no attribute 'USER_AGENT'

app/core/search.py:24: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
_____________________________ ERROR at setup of test_search_with_invalid_type ______________________________

    @pytest.fixture
    async def search_engine():
        """テスト用のMarketSearchEngineインスタンスを作成"""
>       engine = MarketSearchEngine()

tests/unit/test_search.py:10: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.core.search.MarketSearchEngine object at 0x705cad68c760>

    def __init__(self):
        """初期化"""
        self.session = None
        self.search_providers = {
            'news': self._search_news,
            'research': self._search_research,
            'company': self._search_company,
            'social': self._search_social,
        }
        self.headers = {
>           'User-Agent': settings.USER_AGENT
        }
E       AttributeError: module 'app.config.settings' has no attribute 'USER_AGENT'

app/core/search.py:24: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
_________________________________ ERROR at setup of test_content_filtering _________________________________

    @pytest.fixture
    async def search_engine():
        """テスト用のMarketSearchEngineインスタンスを作成"""
>       engine = MarketSearchEngine()

tests/unit/test_search.py:10: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.core.search.MarketSearchEngine object at 0x705cad661db0>

    def __init__(self):
        """初期化"""
        self.session = None
        self.search_providers = {
            'news': self._search_news,
            'research': self._search_research,
            'company': self._search_company,
            'social': self._search_social,
        }
        self.headers = {
>           'User-Agent': settings.USER_AGENT
        }
E       AttributeError: module 'app.config.settings' has no attribute 'USER_AGENT'

app/core/search.py:24: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
________________________________ ERROR at setup of test_concurrent_searches ________________________________

    @pytest.fixture
    async def search_engine():
        """テスト用のMarketSearchEngineインスタンスを作成"""
>       engine = MarketSearchEngine()

tests/unit/test_search.py:10: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.core.search.MarketSearchEngine object at 0x705cad6966e0>

    def __init__(self):
        """初期化"""
        self.session = None
        self.search_providers = {
            'news': self._search_news,
            'research': self._search_research,
            'company': self._search_company,
            'social': self._search_social,
        }
        self.headers = {
>           'User-Agent': settings.USER_AGENT
        }
E       AttributeError: module 'app.config.settings' has no attribute 'USER_AGENT'

app/core/search.py:24: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
_________________________________ ERROR at setup of test_fetch_url_success _________________________________

    @pytest.fixture
    async def web_crawler():
        crawler = WebCrawlerService()
>       await crawler.start_session()
E       AttributeError: 'WebCrawlerService' object has no attribute 'start_session'

tests/unit/test_web_crawler.py:10: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
INFO     app.services.web:web.py:23 WebCrawlerServiceを初期化しました
___________________________ ERROR at setup of test_fetch_url_retry_on_rate_limit ___________________________

    @pytest.fixture
    async def web_crawler():
        crawler = WebCrawlerService()
>       await crawler.start_session()
E       AttributeError: 'WebCrawlerService' object has no attribute 'start_session'

tests/unit/test_web_crawler.py:10: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
INFO     app.services.web:web.py:23 WebCrawlerServiceを初期化しました
____________________________________ ERROR at setup of test_crawl_urls _____________________________________

    @pytest.fixture
    async def web_crawler():
        crawler = WebCrawlerService()
>       await crawler.start_session()
E       AttributeError: 'WebCrawlerService' object has no attribute 'start_session'

tests/unit/test_web_crawler.py:10: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
INFO     app.services.web:web.py:23 WebCrawlerServiceを初期化しました
_____________________________ ERROR at setup of test_fetch_url_error_handling ______________________________

    @pytest.fixture
    async def web_crawler():
        crawler = WebCrawlerService()
>       await crawler.start_session()
E       AttributeError: 'WebCrawlerService' object has no attribute 'start_session'

tests/unit/test_web_crawler.py:10: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
INFO     app.services.web:web.py:23 WebCrawlerServiceを初期化しました
____________________________ ERROR at setup of test_crawl_urls_partial_failure _____________________________

    @pytest.fixture
    async def web_crawler():
        crawler = WebCrawlerService()
>       await crawler.start_session()
E       AttributeError: 'WebCrawlerService' object has no attribute 'start_session'

tests/unit/test_web_crawler.py:10: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
INFO     app.services.web:web.py:23 WebCrawlerServiceを初期化しました
================================================= FAILURES =================================================
____________________________________________ test_build_prompt _____________________________________________

gemini_service = <app.services.gemini.GeminiService object at 0x705cad765900>

    def test_build_prompt(gemini_service):
        """プロンプト構築のテスト"""
        # 正常系
        template = "Hello {name}!"
>       result = gemini_service._build_prompt(template, name="World")
E       AttributeError: 'GeminiService' object has no attribute '_build_prompt'

tests/unit/test_gemini.py:24: AttributeError
______________________________________ test_validate_required_fields _______________________________________

gemini_service = <app.services.gemini.GeminiService object at 0x705cad78b4f0>

    def test_validate_required_fields(gemini_service):
        """必須フィールド検証のテスト"""
        # 正常系
        data = {'name': 'AI', 'type': 'TECHNOLOGY'}
        required_fields = {'name', 'type'}
>       gemini_service._validate_required_fields(data, required_fields)
E       AttributeError: 'GeminiService' object has no attribute '_validate_required_fields'

tests/unit/test_gemini.py:37: AttributeError
________________________________________ test_validate_value_range _________________________________________

gemini_service = <app.services.gemini.GeminiService object at 0x705cad7c39a0>

    def test_validate_value_range(gemini_service):
        """値の範囲検証のテスト"""
        # 正常系
>       gemini_service._validate_value_range(0.5, 0.0, 1.0, 'test_field')
E       AttributeError: 'GeminiService' object has no attribute '_validate_value_range'

tests/unit/test_gemini.py:52: AttributeError
______________________________________ test_validate_analysis_result _______________________________________

gemini_service = <app.services.gemini.GeminiService object at 0x705cad8612d0>

    def test_validate_analysis_result(gemini_service):
        """解析結果検証のテスト"""
        # 正常系
        valid_result = {
            'entities': [
                {
                    'type': 'TECHNOLOGY',
                    'name': 'AI',
                    'description': '人工知能技術'
                }
            ],
            'relationships': [],
            'summary': 'テスト',
            'relevance_market_impact': 0.8,
            'relevance_timeliness': 0.7,
            'relevance_credibility': 0.9,
            'quality_completeness': 0.8,
            'quality_objectivity': 0.7,
            'quality_detail_level': 0.6
        }
>       gemini_service._validate_analysis_result(valid_result)
E       AttributeError: 'GeminiService' object has no attribute '_validate_analysis_result'

tests/unit/test_gemini.py:79: AttributeError
_______________________________________ test_validate_relationships ________________________________________

gemini_service = <app.services.gemini.GeminiService object at 0x705cad76add0>

    def test_validate_relationships(gemini_service):
        """関係性検証のテスト"""
        # 正常系
        valid_relationships = [
            {
                'type': 'INFLUENCES',
                'source': 'AI',
                'target': 'Market',
                'description': 'テスト',
                'confidence': 0.8
            }
        ]
>       gemini_service._validate_relationships(valid_relationships)
E       AttributeError: 'GeminiService' object has no attribute '_validate_relationships'

tests/unit/test_gemini.py:124: AttributeError
_______________________________________ test_validate_impact_scores ________________________________________

gemini_service = <app.services.gemini.GeminiService object at 0x705cad7d0d00>

    def test_validate_impact_scores(gemini_service):
        """影響度スコア検証のテスト"""
        # 正常系
        valid_scores = {
            'market_size': 0.8,
            'technology_trends': 0.7,
            'competitive_landscape': 0.6,
            'regulatory_environment': 0.5,
            'investment_trends': 0.4
        }
>       gemini_service._validate_impact_scores(valid_scores)
E       AttributeError: 'GeminiService' object has no attribute '_validate_impact_scores'

tests/unit/test_gemini.py:161: AttributeError
_______________________________________ test_call_gemini_with_retry ________________________________________

gemini_service = <app.services.gemini.GeminiService object at 0x705cad7b7af0>
mock_genai = <MagicMock name='genai' id='123543349482432'>

    @pytest.mark.asyncio
    async def test_call_gemini_with_retry(gemini_service, mock_genai):
        """Gemini API呼び出しのリトライテスト"""
        # 正常系
        mock_genai.GenerativeModel.return_value.generate_content.return_value.text = '{"test": "data"}'
>       result = await gemini_service._call_gemini_with_retry("test prompt")
E       AttributeError: 'GeminiService' object has no attribute '_call_gemini_with_retry'

tests/unit/test_gemini.py:189: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
------------------------------------------ Captured log teardown -------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
___________________________________________ test_analyze_content ___________________________________________

gemini_service = <app.services.gemini.GeminiService object at 0x705cad860e80>
mock_genai = <MagicMock name='genai' id='123543349803760'>

    @pytest.mark.asyncio
    async def test_analyze_content(gemini_service, mock_genai):
        """コンテンツ解析のテスト"""
        # テストデータ
        content = "テスト用のコンテンツ"
        context = "市場分析のコンテキスト"
    
        # モックの戻り値を設定
        expected_result = {
            'entities': [
                {
                    'type': 'TECHNOLOGY',
                    'name': 'AI',
                    'description': '人工知能技術'
                }
            ],
            'relationships': [],
            'summary': 'AIと機械学習の関係性',
            'relevance_market_impact': 0.8,
            'relevance_timeliness': 0.7,
            'relevance_credibility': 0.9,
            'quality_completeness': 0.8,
            'quality_objectivity': 0.7,
            'quality_detail_level': 0.6
        }
    
        mock_genai.GenerativeModel.return_value.generate_content.return_value.text = json.dumps(expected_res
ult)
    
        # 関数を実行
>       result = await gemini_service.analyze_content(content, context)

tests/unit/test_gemini.py:233: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.services.gemini.GeminiService object at 0x705cad860e80>, content = 'テスト用のコンテンツ'
context = '市場分析のコンテキスト'

    async def analyze_content(self, content: str, context: str) -> Dict:
        """コンテンツを解析
    
        Args:
            content (str): 解析対象のコンテンツ
            context (str): 解析コンテキスト
    
        Returns:
            Dict: 解析結果
        """
        try:
            # プロンプトの作成
            prompt = f"""
            以下のコンテンツを解析し、市場分析に関連する情報を抽出してください。
    
            コンテキスト：
            {context}
    
            コンテンツ：
            {content}
    
            以下の形式でJSON形式で出力してください：
            - entities: エンティティのリスト（企業、技術、市場など）
            - relationships: エンティティ間の関係性
            - summary: 要約
            - relevance_market_impact: 市場への影響度（0.0～1.0）
            - relevance_timeliness: 時宜性（0.0～1.0）
            - relevance_credibility: 信頼性（0.0～1.0）
            - quality_completeness: 完全性（0.0～1.0）
            - quality_objectivity: 客観性（0.0～1.0）
            - quality_detail_level: 詳細度（0.0～1.0）
            """
    
            # Geminiによる解析
>           response = await self.model.generate_content_async(prompt)
E           TypeError: object Mock can't be used in 'await' expression

app/services/gemini.py:55: TypeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
-------------------------------------------- Captured log call ---------------------------------------------
ERROR    app.services.gemini:gemini.py:63 Gemini解析エラー: object Mock can't be used in 'await' expression
------------------------------------------ Captured log teardown -------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
________________________________________ test_extract_relationships ________________________________________

gemini_service = <app.services.gemini.GeminiService object at 0x705cad75c730>
mock_genai = <MagicMock name='genai' id='123543349533648'>

    @pytest.mark.asyncio
    async def test_extract_relationships(gemini_service, mock_genai):
        """関係性抽出のテスト"""
        # テストデータ
        content = {
            'entities': [
                {
                    'type': 'TECHNOLOGY',
                    'name': 'AI',
                    'description': '人工知能技術'
                }
            ],
            'summary': 'AIの市場動向'
        }
    
        context = {
            'entities': [
                {
                    'type': 'MARKET',
                    'name': 'AI市場',
                    'description': 'AI関連の市場'
                }
            ],
            'relationships': []
        }
    
        # モックの戻り値を設定
        expected_result = [
            {
                'type': 'INFLUENCES',
                'source': 'AI',
                'target': 'AI市場',
                'description': '技術が市場に影響を与える',
                'confidence': 0.8
            }
        ]
    
        mock_genai.GenerativeModel.return_value.generate_content.return_value.text = json.dumps(expected_res
ult)
    
        # 関数を実行
>       result = await gemini_service.extract_relationships(content, context)

tests/unit/test_gemini.py:284: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.services.gemini.GeminiService object at 0x705cad75c730>
content = {'entities': [{'description': '人工知能技術', 'name': 'AI', 'type': 'TECHNOLOGY'}], 'summary': 'AI
の市場動向'}
context = {'entities': [{'description': 'AI関連の市場', 'name': 'AI市場', 'type': 'MARKET'}], 'relationships
': []}

    async def extract_relationships(
        self,
        content: Dict,
        context: Dict
    ) -> List[Dict]:
        """関係性を抽出
    
        Args:
            content (Dict): 解析済みコンテンツ
            context (Dict): 解析コンテキスト
    
        Returns:
            List[Dict]: 抽出された関係性のリスト
        """
        try:
            # プロンプトの作成
            prompt = f"""
            以下のコンテンツから、エンティティ間の関係性を抽出してください。
    
            コンテンツ：
            {content}
    
            既存の関係性：
            {context.get('relationships', [])}
    
            以下の形式でJSON形式で出力してください：
            - type: 関係性の種類（INFLUENCES, COMPETES, DEVELOPS, PARTICIPATES）
            - source: 関係性の主体
            - target: 関係性の対象
            - description: 関係性の説明
            - confidence: 確信度（0.0～1.0）
            """
    
            # Geminiによる抽出
>           response = await self.model.generate_content_async(prompt)
E           TypeError: object Mock can't be used in 'await' expression

app/services/gemini.py:100: TypeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
-------------------------------------------- Captured log call ---------------------------------------------
ERROR    app.services.gemini:gemini.py:108 Gemini関係性抽出エラー: object Mock can't be used in 'await' expr
ession
------------------------------------------ Captured log teardown -------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
_______________________________________ test_evaluate_market_impact ________________________________________

gemini_service = <app.services.gemini.GeminiService object at 0x705cad863e80>
mock_genai = <MagicMock name='genai' id='123543349902592'>

    @pytest.mark.asyncio
    async def test_evaluate_market_impact(gemini_service, mock_genai):
        """市場影響度評価のテスト"""
        # テストデータ
        content = {
            'entities': [
                {
                    'type': 'TECHNOLOGY',
                    'name': 'AI',
                    'description': '人工知能技術'
                }
            ],
            'summary': 'AIの市場への影響'
        }
    
        # モックの戻り値を設定
        expected_result = {
            'market_size': 0.8,
            'technology_trends': 0.9,
            'competitive_landscape': 0.7,
            'regulatory_environment': 0.6,
            'investment_trends': 0.7
        }
    
        mock_genai.GenerativeModel.return_value.generate_content.return_value.text = json.dumps(expected_res
ult)
    
        # 関数を実行
>       result = await gemini_service.evaluate_market_impact(content)

tests/unit/test_gemini.py:322: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.services.gemini.GeminiService object at 0x705cad863e80>
content = {'entities': [{'description': '人工知能技術', 'name': 'AI', 'type': 'TECHNOLOGY'}], 'summary': 'AI
の市場への影響'}

    async def evaluate_market_impact(self, content: Dict) -> Dict:
        """市場影響度を評価
    
        Args:
            content (Dict): 解析済みコンテンツ
    
        Returns:
            Dict: 評価結果
        """
        try:
            # プロンプトの作成
            prompt = f"""
            以下のコンテンツから、市場への影響度を評価してください。
    
            コンテンツ：
            {content}
    
            以下の観点で0.0～1.0の値を評価し、JSON形式で出力してください：
            - market_size: 市場規模への影響
            - technology_trends: 技術トレンドへの影響
            - competitive_landscape: 競争環境への影響
            - regulatory_environment: 規制環境への影響
            - investment_trends: 投資動向への影響
            """
    
            # Geminiによる評価
>           response = await self.model.generate_content_async(prompt)
E           TypeError: object Mock can't be used in 'await' expression

app/services/gemini.py:137: TypeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
-------------------------------------------- Captured log call ---------------------------------------------
ERROR    app.services.gemini:gemini.py:145 Gemini市場影響度評価エラー: object Mock can't be used in 'await' 
expression
------------------------------------------ Captured log teardown -------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
_______________________________________________ test_connect _______________________________________________

mock_driver = <MagicMock name='AsyncGraphDatabase' id='123543349890736'>

    @pytest.mark.asyncio
    async def test_connect(mock_driver):
        """接続のテスト"""
>       connection = Neo4jConnection()

tests/unit/test_neo4j.py:25: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.db.neo4j.Neo4jConnection object at 0x705cad7d07f0>

    def __init__(self):
        """初期化"""
>       self.uri = settings.NEO4J_URI
E       AttributeError: module 'app.config.settings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER
'?

app/db/neo4j.py:13: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
------------------------------------------ Captured log teardown -------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
__________________________________________ test_connection_error ___________________________________________

mock_driver = <MagicMock name='AsyncGraphDatabase' id='123543348539216'>

    @pytest.mark.asyncio
    async def test_connection_error(mock_driver):
        """接続エラーのテスト"""
        # モックにエラーを設定
        mock_driver.driver.return_value.verify_connectivity.side_effect = Exception("Connection Error")
    
>       connection = Neo4jConnection()

tests/unit/test_neo4j.py:295: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.db.neo4j.Neo4jConnection object at 0x705cad668670>

    def __init__(self):
        """初期化"""
>       self.uri = settings.NEO4J_URI
E       AttributeError: module 'app.config.settings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER
'?

app/db/neo4j.py:13: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
------------------------------------------ Captured log teardown -------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
___________________________________________ test_extract_content ___________________________________________

    @pytest.mark.asyncio
    async def test_extract_content():
        crawler = WebCrawlerService()
        html = """
        <html>
            <head>
                <title>テストページ</title>
                <meta name="description" content="テスト説明">
            </head>
            <body>
                <nav>ナビゲーション（除外対象）</nav>
                <h1>メインタイトル</h1>
                <p>本文テキスト</p>
                <aside>サイドバー（除外対象）</aside>
            </body>
        </html>
        """
    
>       result = await crawler.extract_content(html)
E       AttributeError: 'WebCrawlerService' object has no attribute 'extract_content'. Did you mean: '_extra
ct_content'?

tests/unit/test_web_crawler.py:32: AttributeError
-------------------------------------------- Captured log setup --------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
-------------------------------------------- Captured log call ---------------------------------------------
INFO     app.services.web:web.py:23 WebCrawlerServiceを初期化しました
------------------------------------------ Captured log teardown -------------------------------------------
DEBUG    asyncio:selector_events.py:54 Using selector: EpollSelector
========================================= short test summary info ==========================================
FAILED tests/unit/test_gemini.py::test_build_prompt - AttributeError: 'GeminiService' object has no attribut
e '_build_prompt'
FAILED tests/unit/test_gemini.py::test_validate_required_fields - AttributeError: 'GeminiService' object has
 no attribute '_validate_required_fields'
FAILED tests/unit/test_gemini.py::test_validate_value_range - AttributeError: 'GeminiService' object has no 
attribute '_validate_value_range'
FAILED tests/unit/test_gemini.py::test_validate_analysis_result - AttributeError: 'GeminiService' object has
 no attribute '_validate_analysis_result'
FAILED tests/unit/test_gemini.py::test_validate_relationships - AttributeError: 'GeminiService' object has n
o attribute '_validate_relationships'
FAILED tests/unit/test_gemini.py::test_validate_impact_scores - AttributeError: 'GeminiService' object has n
o attribute '_validate_impact_scores'
FAILED tests/unit/test_gemini.py::test_call_gemini_with_retry - AttributeError: 'GeminiService' object has n
o attribute '_call_gemini_with_retry'
FAILED tests/unit/test_gemini.py::test_analyze_content - TypeError: object Mock can't be used in 'await' exp
ression
FAILED tests/unit/test_gemini.py::test_extract_relationships - TypeError: object Mock can't be used in 'awai
t' expression
FAILED tests/unit/test_gemini.py::test_evaluate_market_impact - TypeError: object Mock can't be used in 'awa
it' expression
FAILED tests/unit/test_neo4j.py::test_connect - AttributeError: module 'app.config.settings' has no attribut
e 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
FAILED tests/unit/test_neo4j.py::test_connection_error - AttributeError: module 'app.config.settings' has no
 attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
FAILED tests/unit/test_web_crawler.py::test_extract_content - AttributeError: 'WebCrawlerService' object has
 no attribute 'extract_content'. Did you mean: '_extract_...
ERROR tests/unit/test_analyzer.py::test_analyze_content - AttributeError: module 'app.config.settings' has n
o attribute 'CONTENT_ANALYSIS_CRITERIA'
ERROR tests/unit/test_analyzer.py::test_extract_relationships - AttributeError: module 'app.config.settings'
 has no attribute 'CONTENT_ANALYSIS_CRITERIA'
ERROR tests/unit/test_analyzer.py::test_evaluate_market_impact - AttributeError: module 'app.config.settings
' has no attribute 'CONTENT_ANALYSIS_CRITERIA'
ERROR tests/unit/test_crawler.py::test_crawl - TypeError: AdoptiveMarketCrawler.__init__() missing 1 require
d positional argument: 'knowledge_manager'
ERROR tests/unit/test_crawler.py::test_crawl_with_error - TypeError: AdoptiveMarketCrawler.__init__() missin
g 1 required positional argument: 'knowledge_manager'
ERROR tests/unit/test_crawler.py::test_run - TypeError: AdoptiveMarketCrawler.__init__() missing 1 required 
positional argument: 'knowledge_manager'
ERROR tests/unit/test_knowledge.py::test_add_knowledge - AttributeError: module 'app.config.settings' has no
 attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_knowledge.py::test_query_related_knowledge - AttributeError: module 'app.config.settin
gs' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_knowledge.py::test_update_relationships - AttributeError: module 'app.config.settings'
 has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j.py::test_close - AttributeError: module 'app.config.settings' has no attribute '
NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j.py::test_create_node - AttributeError: module 'app.config.settings' has no attri
bute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j.py::test_create_relationship - AttributeError: module 'app.config.settings' has 
no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j.py::test_find_node - AttributeError: module 'app.config.settings' has no attribu
te 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j.py::test_get_relationship - AttributeError: module 'app.config.settings' has no 
attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j.py::test_update_relationship - AttributeError: module 'app.config.settings' has 
no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j.py::test_run_query - AttributeError: module 'app.config.settings' has no attribu
te 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j.py::test_query_error - AttributeError: module 'app.config.settings' has no attri
bute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j_connection.py::test_connect - AttributeError: module 'app.config.settings' has n
o attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j_connection.py::test_create_node - AttributeError: module 'app.config.settings' h
as no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j_connection.py::test_create_relationship - AttributeError: module 'app.config.set
tings' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j_connection.py::test_find_node - AttributeError: module 'app.config.settings' has
 no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j_connection.py::test_connection_error - AttributeError: module 'app.config.settin
gs' has no attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_neo4j_connection.py::test_close - AttributeError: module 'app.config.settings' has no 
attribute 'NEO4J_URI'. Did you mean: 'NEO4J_USER'?
ERROR tests/unit/test_search.py::test_search_with_all_types - AttributeError: module 'app.config.settings' h
as no attribute 'USER_AGENT'
ERROR tests/unit/test_search.py::test_search_with_specific_type - AttributeError: module 'app.config.setting
s' has no attribute 'USER_AGENT'
ERROR tests/unit/test_search.py::test_search_with_invalid_type - AttributeError: module 'app.config.settings
' has no attribute 'USER_AGENT'
ERROR tests/unit/test_search.py::test_content_filtering - AttributeError: module 'app.config.settings' has n
o attribute 'USER_AGENT'
ERROR tests/unit/test_search.py::test_concurrent_searches - AttributeError: module 'app.config.settings' has
 no attribute 'USER_AGENT'
ERROR tests/unit/test_web_crawler.py::test_fetch_url_success - AttributeError: 'WebCrawlerService' object ha
s no attribute 'start_session'
ERROR tests/unit/test_web_crawler.py::test_fetch_url_retry_on_rate_limit - AttributeError: 'WebCrawlerServic
e' object has no attribute 'start_session'
ERROR tests/unit/test_web_crawler.py::test_crawl_urls - AttributeError: 'WebCrawlerService' object has no at
tribute 'start_session'
ERROR tests/unit/test_web_crawler.py::test_fetch_url_error_handling - AttributeError: 'WebCrawlerService' ob
ject has no attribute 'start_session'
ERROR tests/unit/test_web_crawler.py::test_crawl_urls_partial_failure - AttributeError: 'WebCrawlerService' 
object has no attribute 'start_session'
================================= 13 failed, 4 passed, 33 errors in 1.58s ==================================
devuser@f82d54057b41:~/workspace$
```

---



テスト実行の結果、いくつかの問題が見つかりました：

1. 設定関連の問題：
   - `NEO4J_URI`が`settings`モジュールに定義されていない
   - `USER_AGENT`が`settings`モジュールに定義されていない
   - `CONTENT_ANALYSIS_CRITERIA`が`settings`モジュールに定義されていない

2. クラスメソッド関連の問題：
   - `GeminiService`クラスに必要なメソッドが実装されていない
   - `WebCrawlerService`クラスに必要なメソッドが実装されていない

まず、設定ファイルの問題から修正していきましょう。

---

Read file: app/config/settings.py

---



設定ファイルに必要な設定を追加します。

---

```diff
  NEO4J_USER = os.getenv('neo4j_user')
  NEO4J_PASS = os.getenv('neo4j_pswd')
+ NEO4J_URI = f"bolt://{NEO4J_HOST}:7687"  # Neo4jのデフォルトポート
  
  if not NEO4J_USER or not NEO4J_PASS:
      raise ValueError("Neo4j credentials are required")
+ 
+ # クローラー設定
+ USER_AGENT = "Adoptive Market Crawler/1.0"
+ REQUEST_TIMEOUT = 30  # リクエストタイムアウト（秒）
+ MAX_RETRIES = 3      # 最大リトライ回数
+ RETRY_DELAY = 5      # リトライ間隔（秒）
+ 
+ # コンテンツ解析設定
+ CONTENT_ANALYSIS_CRITERIA = {
+     'relevance': {
+         'market_impact': {'min': 0.0, 'max': 1.0},
+         'timeliness': {'min': 0.0, 'max': 1.0},
+         'credibility': {'min': 0.0, 'max': 1.0}
+     },
+     'quality': {
+         'completeness': {'min': 0.0, 'max': 1.0},
+         'objectivity': {'min': 0.0, 'max': 1.0},
+         'detail_level': {'min': 0.0, 'max': 1.0}
+     }
+ }
+ 
+ # 市場影響度評価基準
+ MARKET_IMPACT_CRITERIA = {
+     'market_size': {'min': 0.0, 'max': 1.0},
+     'technology_trends': {'min': 0.0, 'max': 1.0},
+     'competitive_landscape': {'min': 0.0, 'max': 1.0},
+     'regulatory_environment': {'min': 0.0, 'max': 1.0},
+     'investment_trends': {'min': 0.0, 'max': 1.0}
+ }
+ 
+ # 関係性タイプ
+ RELATIONSHIP_TYPES = [
+     'INFLUENCES',    # 影響を与える
+     'COMPETES',     # 競合関係
+     'DEVELOPS',     # 開発関係
+     'PARTICIPATES'  # 参加関係
+ ]
  
```

---



---



---

