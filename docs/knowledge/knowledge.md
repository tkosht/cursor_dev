# 知識ベース

## 外部サイトへのアクセス制御
### スコープ: HTTP通信、クローリング
- ブラウザライクな振る舞いの重要性
  - User-Agentだけでなく、全てのヘッダーをブラウザに合わせる
  - Accept-Encodingは対応可能な圧縮形式のみを指定
  - キャッシュ制御を適切に設定（no-cache, Pragma）
  - Refererヘッダーの活用（検索エンジン経由のアクセスを装う）

- レート制限への対応
  - 同時接続数の制限（max_concurrent=1）
  - アクセス間隔の確保（5秒以上）
  - タイムアウト設定の最適化（connect: 30秒, read: 45秒）

### 再利用場面
- 外部サイトへのクローリング実装時
- アクセス制御の設計時
- エラーハンドリングの実装時

## テストコード設計
### スコープ: テスト実装、品質管理
- 実サイトを使用したテストの重要性
  - モックの使用は避け、実際の環境での動作を確認
  - 外部接続エラーも含め、自らの実装を優先的に確認
  - サイトごとの特性を考慮したテストケース設計

- 適応的機能のテスト手法
  - 異なるサイト構造での動作確認
  - エラーケースの網羅的なテスト
  - レート制限などの実運用を想定した検証

### 再利用場面
- クローラーのテスト実装時
- 外部サイトとの連携機能のテスト時
- エラー処理の検証時

## LLMとの通信制御
### スコープ: LLM連携、エラーハンドリング
- タイムアウト設定の重要性
  - 適切なタイムアウト値の設定
  - エラーハンドリングの実装
  - リトライ処理の組み込み

- エラー検出と対応
  - エラーの種類に応じた適切な処理
  - ログ出力による状況の記録
  - 段階的なエラーハンドリング

### 再利用場面
- LLMを使用した機能の実装時
- 外部APIとの連携時
- エラー処理の設計時