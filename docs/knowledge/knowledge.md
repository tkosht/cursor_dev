# 知識ベース

## IRサイトクローリング

### 1. IRサイトへのアクセス戦略
- **基本方針**
  - 企業の基本URLのみを管理し、IRページは動的に探索
  - 一般的なブラウザの挙動を模倣
  - アクセス間隔を適切に制御
  - 実装例: implementation_patterns.md の `IRSiteLocator` パターンを参照

- **HTTPヘッダー設定のベストプラクティス**
  - 最新のブラウザヘッダーを模倣
  - 言語設定の適切な指定
  - セキュリティ関連ヘッダーの設定
  - 実装例: implementation_patterns.md の `HTTP通信パターン` を参照

### 2. エラーハンドリング戦略
- **階層的なエラー処理**
  1. HTTP通信エラー（403, 429など）
  2. コンテンツ解析エラー
  3. データ抽出エラー
  - 実装例: implementation_patterns.md の `エラーハンドリング階層` パターンを参照

- **リトライ戦略**
  - 指数バックオフを使用（1秒、2秒、4秒...）
  - エラー種別に応じた待機時間の調整
  - 最大リトライ回数の設定
  - 実装例: implementation_patterns.md の `AdaptiveCrawler` パターンを参照

### 3. テスト設計の知見
- **実サイトテストの考慮事項**
  1. 外部依存を考慮したタイムアウト設定
  2. ネットワーク状態の変動への対応
  3. サイト構造の変更への耐性
  - 実装例: implementation_patterns.md の `統合テストパターン` を参照

- **テストの安定性向上**
  1. 動的URL探索による柔軟性確保
  2. 詳細なログ記録による問題分析
  3. アサーションの適切な設計
  - 実装例: implementation_patterns.md の `エラーケーステスト` パターンを参照

### 4. 得られた教訓
1. **固定URLの問題点**
   - サイト構造の変更に弱い
   - メンテナンスコストが高い
   - テストの信頼性が低下
   - 対策例: implementation_patterns.md の `URL探索戦略` パターンを参照

2. **動的探索の利点**
   - サイト変更への耐性が向上
   - メンテナンスコストの削減
   - テストの信頼性向上
   - 実装例: implementation_patterns.md の `IRSiteLocator` パターンを参照

3. **エラー処理の重要性**
   - 詳細なログ記録が問題解決の鍵
   - 適切なリトライ戦略の必要性
   - エラー種別に応じた対応の重要性
   - 実装例: implementation_patterns.md の `エラーハンドリング階層` パターンを参照

### 5. 今後の改善点
1. **LLMの活用**
   - ページ内容の意味的解析
   - 最適なセレクタの動的生成
   - エラーメッセージの解析と対応
   - 検討例: implementation_patterns.md の `LLMOptimizationパターン` を参照

2. **パフォーマンス最適化**
   - 並行処理の制御
   - キャッシュ戦略の検討
   - リソース使用の効率化
   - 実装例: implementation_patterns.md の `ConcurrencyControlパターン` を参照

3. **テスト強化**
   - エラーケースの網羅
   - 回帰テストの自動化
   - パフォーマンステストの追加
   - 実装例: implementation_patterns.md の `統合テストパターン` を参照