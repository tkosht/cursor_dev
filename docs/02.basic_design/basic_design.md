# 基本設計書 (MVP版)

## 1. 目的
本ドキュメントは、X（旧Twitter）のブックマーク情報を検索し、LLMによるRAG（Retrieval-Augmented Generation）を実現するシステムのMVP基本設計を定義するものです。

## 2. システム全体概要
MVPは以下の主要なコンポーネントで構成されます。

- **ブックマーク取得モジュール:**  
  - 公式API（OAuth2認証）を用いてユーザーのブックマークを取得する。

- **検索モジュール:**  
  - 各ツイート本文をベクトル化して、Faissによるベクトル検索を実現する。

- **LLM連携モジュール:**  
  - 検索結果上位の関連ツイート情報を元に、Gemini 2.0 Flashで回答を生成する。

- **ユーザーインターフェース (ai-gradio):**  
  - ai-gradio を用いたシンプルなWebベースのUIを構築し、検索と結果表示を行う。

## 3. MVP アーキテクチャ設計

### 3.1 データフロー
1. **ブックマーク取得:**  
   ユーザーのXアカウントからブックマークデータを取得（最大800件）。

2. **データ保存:**  
   取得したデータは、ツイートID、本文、投稿者、日時などのメタデータとともにJSON形式で保存。

3. **検索:**  
   各ツイート本文は埋め込みベクトルに変換され、Faissに登録。

4. **LLM連携:**  
   検索結果上位の関連ツイートをプロンプトに組み込み、Gemini 2.0 Flashが回答を生成。

5. **UI表示:**  
   ai-gradio UI は、検索結果およびLLM生成の回答を表示。

### 3.2 コンポーネント間の連携
- **API通信:**  
  - ブックマーク取得モジュールは認証情報を環境変数で管理。

- **データ連携:**  
  - 検索モジュールは必要なメタデータを提供。

- **UI連携:**  
  - ai-gradio UIはシンプルな非同期通信を利用。

## 4. 各モジュールの詳細設計

### 4.1 ブックマーク取得モジュール
- **機能:**  
  - OAuth2認証によるブックマーク取得
  - 基本的なエラー処理

- **設計ポイント:**  
  - シンプルな認証フロー
  - 基本的なエラーハンドリング

### 4.2 検索モジュール
- **機能:**  
  - ベクトル検索の基本実装
  - 検索結果の返却

- **設計ポイント:**  
  - Faissインデックスの基本利用
  - シンプルな検索ロジック

### 4.3 LLM連携モジュール
- **機能:**  
  - Gemini 2.0 Flashとの連携
  - 基本的なプロンプト生成

- **設計ポイント:**  
  - シンプルなプロンプト設計
  - 基本的なエラー処理

### 4.4 ai-gradio UI モジュール
- **機能:**  
  - 検索クエリ入力
  - 結果表示
  - 基本的なエラー表示

- **設計ポイント:**  
  - シンプルなレイアウト
  - 基本的なエラーフィードバック

## 5. MVP実装の制約
- **セキュリティ:**  
  - 認証情報は環境変数で管理
  - 基本的なエラー表示

- **エラーハンドリング:**  
  - 基本的な例外捕捉とログ出力
  - シンプルなエラー表示

## 6. 開発環境とツール
- **プログラミング言語:** Python 3.10～3.12  
- **ライブラリ管理:** poetry  
- **テスト:** 基本的な単体テスト  

## 7. MVP完了条件
1. 基本機能の動作確認
   - ブックマーク取得
   - 検索実行
   - LLM回答生成
   - 結果表示

2. 最小限のエラー処理
   - 基本的なエラー表示
   - シンプルなリカバリー

3. 基本的なテスト
   - 主要機能の確認
   - 基本フローの検証

## 8. MVP後の拡張
1. 機能拡張
   - 複数LLM対応
   - 高度な検索機能
   - リアルタイム更新

2. 最適化
   - キャッシュ機構
   - パフォーマンス改善
   - モニタリング実装

3. UI改善
   - 高度なフィルタリング
   - 詳細なエラー表示
   - レスポンシブ対応