# Webページパーサー設計仕様書

## 1. 概要

企業のWebサイトから情報を抽出する際に、LLM（Large Language Model）を活用して動的にページの解析を行うシステムの設計仕様です。

## 2. 目的

- HTMLの構造が変更された場合でも柔軟に対応できる
- セレクターの保守性を向上させる
- 抽出したい情報の意味的な理解を深める

## 3. システム構成

### 3.1 コンポーネント

1. ページローダー
   - Playwrightを使用したページの取得
   - 動的コンテンツの待機処理

2. LLMパーサー
   - OpenAI GPT-4を使用
   - HTMLコンテンツの解析
   - 情報の構造化

3. データ構造化モジュール
   - 抽出データの正規化
   - JSONフォーマットへの変換

### 3.2 処理フロー

1. ページ取得フェーズ
   ```mermaid
   sequenceDiagram
   Crawler->>Page: ページ取得要求
   Page->>Crawler: HTML取得
   Crawler->>LLM: HTML解析要求
   LLM->>Crawler: 構造化データ
   ```

2. データ抽出フェーズ
   - LLMによるコンテンツ解析
   - 必要���報の特定と抽出
   - データの構造化

## 4. LLMの活用方法

### 4.1 プロンプト設計

1. 基本プロンプト
   ```text
   以下のHTMLから[目的の情報]を抽出してください：
   - 抽出項目：[項目リスト]
   - 形式：[期待する出力形式]
   ```

2. コンテキスト情報
   - ページの種類（会社概要、IR情報など）
   - 抽出すべき情報の種類
   - 期待される形式

### 4.2 出力形式

```json
{
  "company_info": {
    "name": "企業名",
    "profile": {
      "established": "設立日",
      "capital": "資本金",
      "employees": "従業員数",
      ...
    }
  }
}
```

## 5. エラーハンドリング

1. LLM解析エラー
   - 解析失敗時のフォールバック処理
   - 従来のセレクターベースの解析への切り替え

2. データ検証
   - スキーマ検証
   - 必須項目の確認
   - データ型の検証

## 6. 拡張性

1. 新規サイト対応
   - サイト固有のプロンプトテンプレート
   - カスタム抽出ルール

2. マルチモデル対応
   - 複数のLLMプロバイダーのサポート
   - モデル切り替え機能

## 7. 性能要件

1. レスポンス時間
   - LLM API呼び出し: 3秒以内
   - 全体の処理時���: 10秒以内

2. 精度要件
   - 情報抽出精度: 95%以上
   - エラー率: 5%以下

## 8. セキュリティ

1. データ保護
   - 機密情報の扱い
   - APIキーの管理

2. アクセス制御
   - レート制限
   - IP制限

## 9. 運用監視

1. ログ管理
   - LLM APIの呼び出しログ
   - パース結果の記録
   - エラーログ

2. アラート
   - エラー率の監視
   - パフォーマンス監視 