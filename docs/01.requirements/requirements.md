# 要件定義書

## 1. 概要
本ドキュメントは、X（旧Twitter）のブックマークをリアルタイムで取得し、RAG（Retrieval-Augmented Generation）を活用するPythonツールの要件を定義します。

## 2. 目的
ユーザが保存したX上のブックマーク（ツイート）を効率的に検索・整理し、自然言語クエリに対してLLMが適切な回答や要約を返す仕組みを構築することを目的とします。

## 3. 対象ユーザ
- 自身のX（旧Twitter）のブックマークを効果的に管理・検索したいユーザ
- セマンティック検索やAIによる自動タグ付けを利用したいユーザ

## 4. 機能要件

### 4.1 ブックマークデータ取得
- **公式APIを利用する場合:**
  - OAuth2認証を用いて、最大800件のブックマークを取得
  - ページネーション対応による最新データの取得
- **非公式手法を利用する場合:**
  - ブラウザのネットワーク呼び出しやGraphQLエンドポイントへのアクセス、ヘッドレスブラウザによるスクレイピング
  - 全件取得および新規追加分の定期的な増分取得
- **リアルタイム更新:**
  - 定期ポーリングやイベント検知により、数分以内に新規取得データを反映

### 4.2 データ保存・管理
- 取得したブックマークデータをローカルデータベース（例：SQLite）やJSON形式にて管理
- 各ツイートの以下メタデータを保存:
  - ツイートID
  - ツイート本文
  - 投稿者
  - 投稿日時
  - メディア情報
- 保存データの更新、削除、同期処理の実装

### 4.3 検索・インデックス機能
- **ベクトル検索:**
  - 各ツイート本文をベクトル埋め込み（Embedding）に変換
  - ベクトルデータベース（例：Faiss, Pinecone）の利用による類似検索
- **キーワード検索:**
  - BM25等による逆引き索引を検討し、短文クエリへの対応
- **フィルタリング:**
  - 投稿者、日時、タグなどのメタデータを利用した絞り込み検索

### 4.4 LLM連携機能
- 検索結果（関連ツイート）をLLMに渡し、回答生成や要約を実施
- デフォルトはGemini 2.0 Flashモデルを使用し、OpenAI GPT、Claude、ローカルのOllamaホストモデル等へ切り替え可能とする
- LLMとの連携におけるプロンプト設計（最大トークン数、コンテキスト調整等）の工夫

### 4.5 ユーザインターフェース (ai-gradio)
- ai-gradioを利用したWebベースのUIの実装
  - 検索クエリ入力欄、実行ボタン、結果表示エリアの設置
  - フィルタ条件（タグ、投稿者、日時等）の入力コンポーネント
  - 検索結果はカードまたはリスト形式で整形表示
- LLM生成の回答や要約結果の別枠表示

### 4.6 タグ付け・フィルタリング機能
- ユーザが手動でタグを付与可能
- LLMを用いた自動タグ生成アルゴリズムの導入
- タグ情報を利用した検索フィルタリング機能の実装

## 5. 非機能要件
- **パフォーマンス:**  
  - 検索結果の応答は数秒以内に完了すること
  - 新規ブックマークの反映は数分以内に実施
- **拡張性:**  
  - モジュール化された設計とし、将来的な機能追加（他SNS対応、複数LLMサポート等）が容易な設計
- **セキュリティ:**  
  - APIキーや認証情報は環境変数管理、コード内に直接ハードコードしない
  - ユーザデータのプライバシー保護および、必要に応じたデータの暗号化
- **信頼性:**  
  - エラーハンドリングと例外処理を徹底し、Twitter APIのレート制限や非公式手法の不具合に対応
- **可用性:**  
  - UIは直感的で、初心者でも操作しやすい設計とする
- **テスト:**  
  - 単体テスト、統合テスト、自動テストを実施し、テストカバレッジ80%以上を目指す

## 6. システム構成
- **言語:** Python 3.10～3.12  
- **ライブラリ管理:** poetry  
- **主なモジュール:**
  - ブックマーク取得モジュール
  - データ保存・管理モジュール
  - 検索・インデックスモジュール（ベクトル検索、BM25等）
  - LLM連携モジュール
  - ai-gradio UI インターフェース
- **データベース:** SQLiteまたはその他軽量DBの利用
- **テストフレームワーク:** pytest

## 7. 制約およびリスク
- **Twitter API制限:**  
  - 公式APIは最大800件およびレート制限（15分間で180リクエスト）
- **非公式手法のリスク:**  
  - ブラウザ自動操作やGraphQLスクレイピングはTwitter利用規約に抵触する可能性があり、自己責任運用となる
- **LLM利用:**  
  - LLMの応答速度、料金、コンテキスト長やトークン制限を考慮する必要がある
- **リアルタイム更新:**  
  - 頻繁なポーリングによりレート制限やパフォーマンス低下の可能性がある

## 8. 今後の課題
- ベクトル検索精度の向上およびハイブリッド検索の検討
- ユーザフィードバックを反映したUI/UXの改善
- 複数LLMエンジンの円滑な切替と連携処理の最適化
- 自動タグ付けアルゴリズムの精度向上と運用検証

## 9. 用語定義
- **ブックマーク:** ユーザがX上で保存したツイート
- **RAG (Retrieval-Augmented Generation):** 検索結果を元にLLMが回答を生成する手法
- **LLM:** 大規模言語モデル（例：Gemini 2.0 Flash、OpenAI GPT、Claudeなど）
- **ベクトル検索:** ツイートテキストを数値ベクトルに変換し、類似度に基づいて検索する手法 