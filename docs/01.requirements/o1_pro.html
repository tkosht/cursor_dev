<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>企業情報クローリングシステム 要件定義書</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 2em;
      line-height: 1.6;
    }
    h1, h2, h3 {
      color: #333;
      margin-top: 1.5em;
      margin-bottom: 0.5em;
    }
    ul {
      margin-bottom: 1em;
    }
    li {
      margin-bottom: 0.3em;
    }
    table {
      border-collapse: collapse;
      margin-bottom: 1em;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 0.5em;
      text-align: left;
    }
    .note {
      color: #999;
      font-size: 0.9em;
    }
  </style>
</head>
<body>

<h1>企業情報クローリングシステム 要件定義書</h1>

<p>
本ドキュメントは、企業情報をWebからクロールし、標準的なデータ構造に保存することで複数企業を横断的に分析できるシステムの要件を定義したものです。<br>
初期プロトタイプからMVP開発を行うことを目的とし、システムの範囲・目的・機能要件などを明確化します。
</p>

<hr>

<h2>1. 目的 (Purpose)</h2>
<ul>
  <li>各企業の基本情報や財務指標、プレスリリースなどを自動収集し、横断的な分析・比較が可能なデータ基盤を構築する。</li>
  <li>競合分析や投資判断、市場動向の把握を精緻化するための一次データを安定して取得・管理する。</li>
  <li>MVP段階では限られた企業数とデータ項目に焦点をあて、「最小限の仕組み」を早期に提供し、運用実績とユーザーフィードバックを得る。</li>
</ul>

<hr>

<h2>2. スコープ (Scope)</h2>
<ul>
  <li><strong>対象企業：</strong>日本国内上場企業を中心に最大100社程度（MVPでの想定）</li>
  <li><strong>取得対象情報：</strong>企業の基本情報、財務情報（売上高・営業利益・純利益など）、プレスリリース、ニュース記事要約</li>
  <li><strong>対象サイト：</strong>企業公式サイト（IRページ等）、主要プレスリリース配信サイト（1～2サイト程度）</li>
  <li><strong>分析対象：</strong>企業別・業種別比較ができるよう最低限のデータを集約</li>
  <li><strong>アウトオブスコープ（MVP時点）：</strong>
    <ul>
      <li>特許情報、ESGデータ、PDFからの自動抽出などの高度な機能</li>
      <li>大規模データレイクの構築</li>
      <li>個人情報を含むデータの詳細分析</li>
    </ul>
  </li>
</ul>

<hr>

<h2>3. 前提条件 (Assumptions)</h2>
<ul>
  <li>クローリング対象企業のリストは事前に管理側で準備される。</li>
  <li>クローリング頻度は週1回～日1回程度で、システムリソースや利用規約に反しない範囲で実行可能。</li>
  <li>APIやRSSが利用できる場合は優先して使用し、HTML解析によるスクレイピングを補助的に行う。</li>
  <li>大規模な分散処理は当面不要と想定し、単一サーバーまたはクラウド上のバッチ処理で対応する。</li>
</ul>

<hr>

<h2>4. 要求機能 (Requirements)</h2>

<h3>4.1 収集対象データの定義</h3>
<ul>
  <li>企業基本情報
    <ul>
      <li>企業名（正式名称・英語名・表記ゆれ統一）</li>
      <li>設立年</li>
      <li>所在地</li>
      <li>代表者</li>
      <li>URL</li>
    </ul>
  </li>
  <li>財務情報
    <ul>
      <li>売上高</li>
      <li>営業利益</li>
      <li>純利益</li>
      <li>決算期（四半期・年次など）</li>
    </ul>
  </li>
  <li>ニュース／プレスリリース情報
    <ul>
      <li>ニュース／リリースのタイトル</li>
      <li>公開日</li>
      <li>本文または要約（全文スクレイピングが問題ない範囲に限定）</li>
      <li>ソースURL</li>
    </ul>
  </li>
</ul>

<h3>4.2 データ取得手法</h3>
<ul>
  <li>HTMLスクレイピング
    <ul>
      <li>BeautifulSoup, Playwright などのライブラリを利用</li>
      <li>robots.txt を遵守し、過剰な負荷をかけないようレートリミットを設定</li>
    </ul>
  </li>
  <li>RSS／APIを提供しているサイトの場合は優先的に活用</li>
  <li>取得スケジュール・頻度
    <ul>
      <li>週1回のバッチ実行をベースとし、必要に応じて日1回に増やす</li>
      <li>決算情報は四半期発表のタイミングでキャッチアップ</li>
    </ul>
  </li>
</ul>

<h3>4.3 データ品質管理</h3>
<ul>
  <li>クレンジング
    <ul>
      <li>文字化け除去、改行処理、不要タグの除去</li>
      <li>日付、数値のフォーマット正規化（ISO 8601、通貨単位など）</li>
    </ul>
  </li>
  <li>バリデーション
    <ul>
      <li>想定外の値域（マイナス売上など）の場合はログへ警告</li>
      <li>重複データ検出（同一URLや同一ニュースID）</li>
    </ul>
  </li>
</ul>

<h3>4.4 データスキーマ・保存</h3>
<ul>
  <li>データベース
    <ul>
      <li>当面はリレーショナルDB（PostgreSQL 等）</li>
      <li>Companyテーブル、Financialテーブル、Newsテーブルなどを定義</li>
      <li>拡張性を考慮し、将来的にM&A、ESG、特許情報などを追加可能な設計</li>
    </ul>
  </li>
  <li>バージョン管理
    <ul>
      <li>ニュースや決算など更新履歴が必要なデータは、「取得日時」「レポート日時」等をキーに記録</li>
    </ul>
  </li>
</ul>

<h3>4.5 出力・分析要件</h3>
<ul>
  <li>最小限のレポート機能
    <ul>
      <li>企業別・業種別の売上推移、ニュース記事件数の可視化</li>
      <li>CSV, JSON 形式のエクスポート機能</li>
      <li>後続のBIツール連携（Tableau, Looker 等）を想定</li>
    </ul>
  </li>
  <li>ダッシュボード（MVPの範囲では必須ではないが、要検討）
    <ul>
      <li>シンプルなWeb UI か、既存BIツールとの連携</li>
    </ul>
  </li>
</ul>

<hr>

<h2>5. 非機能要件 (Non-functional Requirements)</h2>

<h3>5.1 パフォーマンス・スケーラビリティ</h3>
<ul>
  <li>対象企業数が100社程度までであれば、週1回～日1回のクロールでも十分対応可能。</li>
  <li>将来的に数千社～数万社へ拡大する場合は、分散クローラー／クラウドバッチの導入を検討。</li>
</ul>

<h3>5.2 セキュリティ・アクセス制御</h3>
<ul>
  <li>クローラーの実行環境はAWS等のクラウドを想定。アクセスキーや秘密情報は安全に管理。</li>
  <li>DBには最低限の認証・権限管理を設定。不要なポート公開を防ぐ。</li>
  <li>機密情報（個人情報）はMVPでは原則取得しない。</li>
</ul>

<h3>5.3 運用保守性</h3>
<ul>
  <li>定期ジョブ管理：cron、Airflow、Lambda等の運用ツール導入。</li>
  <li>ログ・監視：スクレイピング失敗時や異常値検出時には通知を行う。</li>
  <li>サイト構造変更への対応：対象サイトのHTML構造が変化した場合の修正フローを明確化。</li>
</ul>

<hr>

<h2>6. 法的・倫理的側面</h2>
<ul>
  <li>スクレイピング対象サイトの利用規約や robots.txt を厳守。</li>
  <li>ニュースやプレスリリースの全文を保管・公開する場合、著作権に注意。必要に応じて抜粋要約にとどめる。</li>
  <li>個人情報が含まれる場合は取得対象外または匿名化（採用情報、役員の詳細住所等）。</li>
  <li>海外企業を扱う場合はGDPR等の国際規制を考慮。</li>
</ul>

<hr>

<h2>7. 運用プロセスの流れ (サマリー)</h2>
<ol>
  <li><strong>企業リスト登録：</strong>対象企業リストをDBに登録。</li>
  <li><strong>クローリング実行：</strong>週1回（または日1回）のスケジュールでIRサイト・プレスリリースサイトを巡回し、HTML/API/RSSからデータ取得。</li>
  <li><strong>データクレンジング：</strong>取得テキストを整形、数値や日付フォーマットを統一。</li>
  <li><strong>DB保存：</strong>重複チェック・バリデーション後にCompany, Financial, Newsテーブルへ登録。</li>
  <li><strong>レポート生成：</strong>分析用にCSV/JSON出力、またはBIツールに取り込み。</li>
  <li><strong>エラー・変更対応：</strong>サイト構造変更や取得エラーを監視し、修正実施。</li>
</ol>

<hr>

<h2>8. リスク・課題 (Risks and Issues)</h2>
<ul>
  <li>対象サイトのレイアウト変更によりスクレイピング処理が動かなくなる。</li>
  <li>クローリング負荷・アクセス制限によりサイト側からブロックされる可能性。</li>
  <li>大量データ蓄積によるDBパフォーマンス低下。</li>
  <li>スクレイピング対象の利用規約・著作権への違反リスク。</li>
</ul>

<hr>

<h2>9. 承認・更新履歴 (Approval & Revision History)</h2>
<table>
  <thead>
    <tr>
      <th>バージョン</th>
      <th>更新日</th>
      <th>更新内容</th>
      <th>更新者</th>
      <th>承認</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0.1 (Draft)</td>
      <td>YYYY-MM-DD</td>
      <td>初版作成</td>
      <td>作成者名</td>
      <td>承認者名</td>
    </tr>
  </tbody>
</table>

<p class="note">
※本要件定義書は、初期MVP開発のための基本的な要件を定義したものであり、運用の過程で追加・変更される可能性があります。
</p>

</body>
</html>
