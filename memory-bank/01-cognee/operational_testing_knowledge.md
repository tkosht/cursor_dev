# Cognee運用テストナレッジ - TDDアプローチ

**作成日**: 2025-06-15  
**目的**: Claude Agent の実運用におけるCognee活用をテストドリブンで検証

## 🔴 Red Phase: 失敗するテストケース（実行前）

### テストケース1: 必須ルール検索
**期待**: ユーザー認証ルールを素早く発見できる
**現状**: 未検証
```bash
# Test: 緊急時にユーザー認証ルールを即座に発見できるか
mcp__cognee__search --search_query "ユーザー認証の必須ルール" --search_type "GRAPH_COMPLETION"
# 期待結果: 具体的なルール内容を3秒以内で取得
```

### テストケース2: 実装パターン発見
**期待**: TDD実装手順を具体的に取得できる
**現状**: 未検証
```bash
# Test: 開発中にTDD手順を即座に確認できるか
mcp__cognee__search --search_query "TDD実装手順" --search_type "INSIGHTS"
# 期待結果: Red-Green-Refactorの具体的ステップを取得
```

### テストケース3: セキュリティパターン検索
**期待**: セキュリティ関連の知識を包括的に取得できる
**現状**: 未検証
```bash
# Test: セキュリティ問題発生時に関連知識を素早く収集できるか
mcp__cognee__search --search_query "セキュリティパターン" --search_type "CHUNKS"
# 期待結果: アンチハッキングルールとセキュリティパターンの両方を取得
```

### テストケース4: 関係性分析
**期待**: 複数概念の関係性を理解できる
**現状**: 未検証
```bash
# Test: 複雑な概念間の関係を理解できるか
mcp__cognee__search --search_query "TDDとコード品質の関係" --search_type "INSIGHTS"
# 期待結果: ノード関係性グラフで具体的な関連性を表示
```

### テストケース5: フォールバック戦略
**期待**: Cognee失敗時にローカル検索に自然に切り替えられる
**現状**: 未検証
```bash
# Test: Cognee検索で見つからない場合のフォールバック
# 1. Cognee検索実行
# 2. 結果不十分なら即座にGrep実行
grep -r "検索語" memory-bank/
# 期待結果: シームレスな情報取得継続
```

## 🔧 テスト実行環境準備

### 前提条件チェック
```bash
# Cognee処理状況確認
mcp__cognee__cognify_status
# 期待: DATASET_PROCESSING_COMPLETED

# 登録ナレッジ確認
ls -la memory-bank/*.md | wc -l
# 期待: 50+ ファイル存在
```

## 🎯 成功基準定義

### パフォーマンス基準
- **応答時間**: 3秒以内
- **的確性**: 期待情報を含む
- **完全性**: 関連情報も含む

### 品質基準
- **関連性**: クエリに直接関連
- **実用性**: 実際の作業に使用可能
- **信頼性**: 正確な情報

### 操作性基準
- **直感性**: 自然な検索語で発見可能
- **効率性**: 従来方法より高速
- **継続性**: エラー時の回復可能

---

## 🟢 Green Phase: テスト実行と結果（完了）

### ✅ テスト結果サマリー（全5テスト合格）

#### テストケース1: 必須ルール検索 - **合格**
```bash
mcp__cognee__search --search_query "ユーザー認証の必須ルール" --search_type "GRAPH_COMPLETION"
```
**結果**: ✅ **即座に具体的ルール取得**
- 絶対禁止事項、必須実行プロセス、強制実行ルールを包括的に表示
- 応答時間: < 3秒
- 実用性: 緊急時の迅速な情報取得に成功

#### テストケース2: TDD実装手順検索 - **合格**
```bash
mcp__cognee__search --search_query "TDD実装手順" --search_type "INSIGHTS"
mcp__cognee__search --search_query "TDD Red Green Refactor 手順" --search_type "GRAPH_COMPLETION"
```
**結果**: ✅ **構造的理解 + 具体的手順の両方取得**
- INSIGHTS: TDD実装の関係性マップを表示
- GRAPH_COMPLETION: "1. RED: 失敗するテストを書く、2. GREEN: 最小限の実装、3. REFACTOR: 品質向上"
- 開発中の即座参照に最適

#### テストケース3: セキュリティパターン検索 - **合格**
```bash
mcp__cognee__search --search_query "セキュリティパターン" --search_type "CHUNKS"
```
**結果**: ✅ **包括的セキュリティ情報取得**
- 自動化機能テスト必須化ルール（詳細チェックリスト付き）
- AIエージェント委託パターン（セキュリティ考慮事項含む）
- ユーザー承認必須ルール（構造変更・根拠なき説得の禁止）
- 開発ワークフロールール（セキュリティレビューフェーズ含む）

#### テストケース4: 関係性分析 - **合格**
```bash
mcp__cognee__search --search_query "TDDとコード品質の関係" --search_type "INSIGHTS"
```
**結果**: ✅ **詳細な関係性グラフ取得**
- TDD実装 → セルフレビュー → コード品質の関係性を明確化
- カバレッジ基準、品質基準達成チェックとの関連性表示
- 複雑な概念間の構造的理解に成功

#### テストケース5: フォールバック戦略 - **合格**
```bash
# Cognee検索: 存在しない情報
mcp__cognee__search --search_query "存在しない概念XYZ123" --search_type "GRAPH_COMPLETION"
# フォールバック: ローカル検索
grep -r "存在しない概念XYZ123" memory-bank/
```
**結果**: ✅ **適切なフォールバック動作**
- Cognee: "提供されたコンテキストには含まれていません" - 適切な応答
- Grep: "No files found" - 確実な確認
- シームレスな情報取得継続が可能

## 🔵 Refactor Phase: 運用戦略最適化

### 検証された最適な使い分け戦略

#### 🎯 Cognee優先使用場面
1. **概念理解・関係性把握**: INSIGHTS検索で構造的理解
2. **包括的情報取得**: GRAPH_COMPLETION で詳細回答
3. **テーマ別情報収集**: CHUNKS検索で関連情報一括取得
4. **探索的学習**: 未知領域の段階的理解

#### 🎯 ローカル文書優先使用場面  
1. **確実性が必要**: 100%の情報網羅が必要
2. **特定ファイル特定**: ファイル名・パス等の具体的検索
3. **フォールバック**: Cognee結果不十分時の補完
4. **デバッグ・トラブルシュート**: エラーメッセージ等の精密検索

#### 🔄 実証された運用フロー
```bash
# Step 1: Cognee探索検索（関連性理解）
mcp__cognee__search --search_query "目的の概念" --search_type "GRAPH_COMPLETION"

# Step 2: 関係性深堀り（必要に応じて）  
mcp__cognee__search --search_query "関連概念" --search_type "INSIGHTS"

# Step 3: フォールバック確認（必要に応じて）
grep -r "特定キーワード" memory-bank/

# Step 4: 実装・活用
```

### パフォーマンス実績
- **応答速度**: 全テスト3秒以内完了
- **情報品質**: 期待情報を100%取得
- **フォールバック成功率**: 100%
- **実用性**: 実際の開発作業で即座活用可能

### 改善提案
1. **検索クエリ最適化**: より具体的なクエリでさらに精密な結果取得
2. **CHUNKS活用拡大**: テーマ別包括検索での情報発見
3. **INSIGHTS活用**: 複雑な概念の関係性理解に積極活用
