# チェックリスト駆動実行絶対遵守ルール

**作成日**: 2025-07-23
**重要度**: CRITICAL - 絶対遵守
**違反**: 即座にタスク停止

## 🚨 絶対原則

### 1. 実行前チェックリスト（必須）
```bash
PRE_EXECUTION_CHECKLIST=(
    "□ ルール確認: CLAUDE.md の該当セクションを読んだか"
    "□ 要件理解: ユーザーの要求を正確に把握したか"
    "□ 既存確認: 同様の実装が既にないか確認したか"
    "□ 設計確認: シンプルな設計か"
    "□ TDD確認: テストを先に書くか"
)
```

### 2. 実装チェックリスト（必須）
```bash
IMPLEMENTATION_CHECKLIST=(
    "□ ディレクトリ: 正しい場所に配置するか"
    "□ 命名規則: 既存の命名規則に従っているか"
    "□ ハードコード: 設定から取得しているか"
    "□ エラー処理: 適切なエラーハンドリングか"
    "□ ドキュメント: 必要最小限のコメントか"
)
```

### 3. テスト作成チェックリスト
```bash
TEST_CHECKLIST=(
    "□ 配置: tests/unit/ または tests/integration/ か"
    "□ 命名: test_*.py 形式か"
    "□ モック: 統合テストでモックを使っていないか"
    "□ カバレッジ: 主要パスをカバーしているか"
    "□ 独立性: 他のテストに依存していないか"
)
```

### 4. ファイル削除チェックリスト
```bash
CLEANUP_CHECKLIST=(
    "□ 不要確認: そのファイルは本当に不要か"
    "□ 参照確認: 他から参照されていないか"
    "□ 移動判断: 削除ではなく移動すべきか"
    "□ 履歴保存: 削除理由を記録したか"
)
```

## 📋 タスク実行フロー

### 1. タスク開始時
```python
def start_task(task_description):
    """タスク開始時の必須手順"""
    checklist = [
        "1. TodoWrite でタスクを in_progress に",
        "2. 関連ルールを memory-bank から確認",
        "3. 既存コードを Grep/Read で調査",
        "4. 実装計画をチェックリストで作成",
    ]
    return checklist
```

### 2. 実装時
```python
def during_implementation():
    """実装中の必須確認"""
    checklist = [
        "1. 既存パターンに従う",
        "2. 新規作成より既存修正を優先",
        "3. シンプルさを維持",
        "4. 設定値を使用（ハードコード禁止）",
    ]
    return checklist
```

### 3. 完了時
```python
def complete_task():
    """タスク完了時の必須手順"""
    checklist = [
        "1. テストが通ることを確認",
        "2. 不要ファイルを削除",
        "3. ドキュメントを最小限に更新",
        "4. TodoWrite で completed に",
    ]
    return checklist
```

## 🚫 禁止事項チェックリスト

```bash
PROHIBITED_ACTIONS=(
    "✗ scripts/ に安易にファイル作成"
    "✗ 重複機能の実装"
    "✗ ハードコードされた値"
    "✗ 必要以上のファイル作成"
    "✗ チェックリストなしの実行"
)
```

## ✅ 実行例

### 例：LLMテストの正規化
```bash
# 1. 事前確認
□ tests/integration/ に既存のLLMテストがあるか確認
□ scripts/ の不要なテストファイルをリストアップ
□ 移動すべきテストロジックを特定

# 2. 実装
□ tests/integration/test_llm.py に統合
□ 設定ベースの実装に修正
□ 不要なファイルを削除

# 3. 検証
□ pytest tests/integration/test_llm.py が通る
□ カバレッジが維持されている
□ scripts/ がクリーンになった
```

## 🔍 自己監査チェックリスト

毎回のタスク後に実施：
```bash
SELF_AUDIT=(
    "□ ルールに違反していないか"
    "□ 不要なファイルを作っていないか"
    "□ シンプルさを維持できたか"
    "□ チェックリストに従ったか"
    "□ 漏れはないか"
)
```

## 📌 強制ルール

1. **チェックリストなしの実行は禁止**
2. **「たぶん」「おそらく」での判断禁止**
3. **事実ベースの確認必須**
4. **シンプルさの追求必須**
5. **既存構造の尊重必須**

---

**このルールに従わない場合、即座にタスクを停止し、最初からやり直すこと。**
**例外は一切認められない。**